import{_ as U,r,U as f,i as V,N as $,o as I,b as m,e as s,f as E,x as N,g as _,K as M,L as O,t as h,y as T,E as z,af as H,H as P,D as b,ag as G,z as J,d as u,n as K,s as W,J as Y,V as j}from"./index-DlPxD2p5.js";import{M as q}from"./MovieList-BJNe_Gvz.js";import{N as Q}from"./ToastMessage-DV5wb5-Z.js";import{B as X}from"./BaseModal-CbOIeYMz.js";const Z={class:"wrapper"},ee={class:"user-lists-page",tabindex:"0"},ae={class:"controls"},se={class:"filter-card type-card"},te={class:"button-group type-buttons"},oe=["onClick"],le={key:0,class:"counter"},re={key:0,class:"empty-state"},ie={__name:"UserLists",setup(ne){const o=r([]),c=r(!0),v=r(f.FAVORITE),i=r(""),p=r(null),n=V(),A=$(),g=J(),d=r(A.params.user_id),y=r(!1),k=r({}),w=r(null),S=async()=>{try{d.value?await navigator.clipboard.writeText("".concat(window.location.href)):await navigator.clipboard.writeText("".concat(window.location.href,"/").concat(n.user.id)),w.value.showNotification("Скопировано")}catch(a){console.error("Ошибка копирования:",a)}},x=[{label:"Избранное",value:f.FAVORITE},{label:"Смотрю",value:f.WATCHING},{label:"Позже",value:f.LATER},{label:"Просмотрено",value:f.COMPLETED},{label:"Брошено",value:f.ABANDONED}],L=async()=>{var a;try{const e=d.value||((a=n.user)==null?void 0:a.id);e&&(k.value=await G(e))}catch(e){console.error("Error fetching counters:",e)}},C=async()=>{c.value=!0,i.value="",p.value=null;try{d.value?o.value=await H(v.value,d.value):o.value=await P(v.value),await L()}catch(a){const{message:e,code:l}=b(a);i.value=e,p.value=l,o.value=[]}finally{c.value=!1}},F=a=>{v.value=a,C()},R=async()=>{if(c.value=!0,n.token)try{await Y(v.value),o.value=[],w.value.showNotification("Список очищен")}catch(a){const{message:e,code:l}=b(a);i.value=e,p.value=l,console.error("Ошибка при очистке списка:",a),l===401&&(n.logout(),await g.push("/login"),g.go(0))}c.value=!1,y.value=!1},B=async a=>{if(n.token)try{await j(a,v.value),o.value=o.value.filter(e=>e.kp_id!==a),w.value.showNotification("Фильм удален из списка"),await L()}catch(e){const{message:l,code:t}=b(e);i.value=l,p.value=t,console.error("Ошибка при удалении фильма:",e),t===401&&(n.logout(),await g.push("/login"),g.go(0))}};return I(C),(a,e)=>{var l;return u(),m(M,null,[s("div",Z,[s("div",ee,[s("div",ae,[s("div",se,[s("div",te,[e[5]||(e[5]=s("i",{class:"material-icons card-icon"},"movie",-1)),(u(),m(M,null,O(x,(t,D)=>s("button",{key:D,class:K(["filter-btn type-btn",{active:v.value===t.value}]),onClick:ue=>F(t.value)},[W(h(t.label)+" ",1),k.value[t.value]?(u(),m("span",le,"("+h(k.value[t.value])+")",1)):_("",!0)],10,oe)),64)),s("button",{class:"share-btn",onClick:e[0]||(e[0]=t=>S())},e[3]||(e[3]=[s("span",{class:"material-icons"},h("share"),-1)])),o.value.length>0&&(!d.value||String(d.value)===String((l=T(n).user)==null?void 0:l.id))?(u(),m("button",{key:0,class:"clear-btn",onClick:e[1]||(e[1]=t=>y.value=!0)},e[4]||(e[4]=[s("span",{class:"material-icons"},h("delete_sweep"),-1)]))):_("",!0)])])]),o.value.length===0&&!c.value?(u(),m("div",re,e[6]||(e[6]=[s("span",{class:"material-icons"},"movie",-1),s("p",null,"Нет фильмов для отображения",-1)]))):i.value?_("",!0):(u(),N(T(q),{key:1,"movies-list":o.value,"is-history":!1,loading:c.value,onItemDeleted:B},null,8,["movies-list","loading"])),i.value?(u(),N(z,{key:2,message:i.value,code:p.value},null,8,["message","code"])):_("",!0)])]),E(Q,{ref_key:"notificationRef",ref:w},null,512),E(X,{"is-open":y.value,message:"Вы уверены, что хотите очистить список?",onConfirm:R,onClose:e[2]||(e[2]=t=>y.value=!1)},null,8,["is-open"])],64)}}},pe=U(ie,[["__scopeId","data-v-3a530301"]]);export{pe as default};
//# sourceMappingURL=UserLists-04T9DnJ7.js.map
