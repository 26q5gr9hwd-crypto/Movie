import{_ as $,z as x,b as o,d as n,e as t,g as l,t as b,y as _,n as R,ai as M,i as T,r as A,c as I,o as L,a as S,x as p,s as N,f as w,E,K as B,L as H}from"./index-Dx8gVGiY.js";import{f as P,u as V}from"./dateUtils-BzlEjnk1.js";import{S as q}from"./SpinnerLoading-B3rgvMtY.js";const z={class:"notification-content"},D={key:0,class:"movie-poster"},F=["src","alt"],U={class:"notification-main"},j={class:"notification-header"},K={class:"notification-info"},O={class:"notification-time"},G={class:"notification-message"},J={key:0,class:"original-comment"},Q=["innerHTML"],W={key:1,class:"reply-comment"},X=["innerHTML"],Y={class:"notification-actions"},Z={key:0,class:"unread-indicator"},tt={__name:"NotificationItem",props:{notification:{type:Object,required:!0}},emits:["mark-read","delete"],setup(i,{emit:e}){const s=i,y=e,f=x(),{formatContent:u}=V(),r=d=>d?u(d):"",k=()=>{y("mark-read",s.notification.id)},g=()=>{y("delete",s.notification.id)},v=()=>{f.push("/movie/".concat(s.notification.movie_id))},h=()=>{const d=s.notification.reply_comment_id?"#comment-".concat(s.notification.reply_comment_id):s.notification.comment_id?"#comment-".concat(s.notification.comment_id):"";f.push("/movie/".concat(s.notification.movie_id).concat(d))};return(d,c)=>(n(),o("div",{class:R(["notification-item",{unread:!i.notification.is_read,read:i.notification.is_read}])},[t("div",z,[i.notification.movie_cover?(n(),o("div",D,[t("img",{src:i.notification.movie_cover,alt:i.notification.movie_title,class:"poster-img",onClick:v},null,8,F)])):l("",!0),t("div",U,[t("div",j,[t("div",K,[t("span",{class:"movie-title",onClick:v},b(i.notification.movie_title),1)]),t("div",O,b(_(P)(i.notification.created_at)),1)]),t("div",G,b(i.notification.message),1),i.notification.comment_content||i.notification.reply_content?(n(),o("div",{key:0,class:"comment-preview",onClick:h},[i.notification.comment_content?(n(),o("div",J,[c[0]||(c[0]=t("i",{class:"fas fa-quote-left"},null,-1)),t("span",{class:"comment-text",innerHTML:r(i.notification.comment_content)},null,8,Q)])):l("",!0),i.notification.reply_content?(n(),o("div",W,[c[1]||(c[1]=t("i",{class:"fas fa-reply"},null,-1)),t("span",{class:"comment-text",innerHTML:r(i.notification.reply_content)},null,8,X)])):l("",!0)])):l("",!0)]),t("div",Y,[i.notification.is_read?l("",!0):(n(),o("button",{key:0,onClick:k,class:"action-btn mark-read-btn",title:"Отметить как прочитанное"},c[2]||(c[2]=[t("i",{class:"fas fa-check"},null,-1)]))),t("button",{onClick:g,class:"action-btn delete-btn",title:"Удалить уведомление"},c[3]||(c[3]=[t("i",{class:"fas fa-trash"},null,-1)]))])]),i.notification.is_read?l("",!0):(n(),o("div",Z))],2))}},it=$(tt,[["__scopeId","data-v-cc93a225"]]),nt={class:"notifications-page"},ot={class:"container"},et={class:"notifications-header"},at={key:0,class:"header-actions"},st=["disabled"],ct={key:0,class:"loading-container"},lt={key:2,class:"empty-state"},rt={key:3,class:"notifications-list"},dt={__name:"NotificationsPage",setup(i){const e=M(),s=T(),y=x(),f=A(!1),u=I(()=>e.notifications);L(async()=>{if(!s.token){y.push("/login");return}await v(),k()}),S(()=>{g()});let r=null;function k(){r=setInterval(()=>{e.fetchUnreadCount()},3e4)}function g(){r&&(clearInterval(r),r=null)}async function v(){await e.fetchNotifications()}async function h(){f.value=!0;try{await e.markAsRead()}catch(m){console.error("Error marking all as read:",m)}finally{f.value=!1}}async function d(m){try{await e.markAsRead([m])}catch(a){console.error("Error marking notification as read:",a)}}async function c(m){try{await e.deleteNotification(m)}catch(a){console.error("Error deleting notification:",a)}}return(m,a)=>(n(),o("div",nt,[t("div",ot,[t("div",et,[a[1]||(a[1]=t("h1",{class:"page-title"},[t("i",{class:"fas fa-bell"}),N(" Уведомления ")],-1)),u.value.length>0?(n(),o("div",at,[_(e).unreadCount>0?(n(),o("button",{key:0,onClick:h,class:"btn btn-secondary",disabled:f.value},a[0]||(a[0]=[t("i",{class:"fas fa-check-double"},null,-1),N(" Отметить все как прочитанные ")]),8,st)):l("",!0)])):l("",!0)]),_(e).loading?(n(),o("div",ct,[w(q),a[2]||(a[2]=t("p",{class:"loading-text"},"Загрузка уведомлений...",-1))])):_(e).error?(n(),p(E,{key:1,message:_(e).error,onRetry:v},null,8,["message"])):u.value.length===0?(n(),o("div",lt,a[3]||(a[3]=[t("i",{class:"fas fa-bell-slash empty-icon"},null,-1),t("h3",{class:"empty-title"},"Нет уведомлений",-1),t("p",{class:"empty-text"}," Когда кто-то ответит на ваш комментарий, вы увидите уведомление здесь ",-1)]))):(n(),o("div",rt,[(n(!0),o(B,null,H(u.value,C=>(n(),p(it,{key:C.id,notification:C,onMarkRead:d,onDelete:c},null,8,["notification"]))),128))]))])]))}},vt=$(dt,[["__scopeId","data-v-7293a820"]]);export{vt as default};
