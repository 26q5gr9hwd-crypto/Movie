import{_ as $,p as w,b as o,i as e,d as t,j as c,e as g,w as N,l as b,t as h,D as u,n as A,aC as I,x as M,r as S,c as E,o as L,G as T,a as B,m as x,E as H,F as P,f as V}from"./index-5-ov-cgP.js";import{f as D}from"./dateUtils-BWepax9P.js";import{u as F}from"./useCommentFormatting-PC7jYMXg.js";import{S as j}from"./SpinnerLoading-B5hmf6td.js";const q={class:"notification-content"},U={key:0,class:"movie-poster"},z=["src","alt"],G={class:"notification-main"},O={class:"notification-header"},J={class:"notification-info"},K={class:"notification-time"},Q={class:"notification-message"},W={key:0,class:"comment-preview"},X={key:0,class:"original-comment"},Y=["innerHTML"],Z={key:1,class:"reply-comment"},tt=["innerHTML"],it={class:"notification-actions"},et={key:0,class:"unread-indicator"},ot={__name:"NotificationItem",props:{notification:{type:Object,required:!0}},emits:["mark-read","delete"],setup(i,{emit:n}){const v=i,_=n,{formatContent:f}=F(),l=m=>m?f(m):"",r=()=>{_("mark-read",v.notification.id)},y=()=>{_("delete",v.notification.id)};return(m,s)=>{const k=w("router-link");return e(),o("div",{class:A(["notification-item",{unread:!i.notification.is_read,read:i.notification.is_read}])},[t("div",q,[i.notification.movie_cover?(e(),o("div",U,[g(k,{to:"/movie/".concat(i.notification.movie_id)},{default:N(()=>[t("img",{src:i.notification.movie_cover,alt:i.notification.movie_title,class:"poster-img"},null,8,z)]),_:1},8,["to"])])):c("",!0),t("div",G,[t("div",O,[t("div",J,[g(k,{to:"/movie/".concat(i.notification.movie_id),class:"movie-title"},{default:N(()=>[b(h(i.notification.movie_title),1)]),_:1},8,["to"])]),t("div",K,h(u(D)(i.notification.created_at)),1)]),t("div",Q,h(i.notification.message),1),i.notification.comment_content||i.notification.reply_content?(e(),o("div",W,[i.notification.comment_content?(e(),o("div",X,[s[0]||(s[0]=t("i",{class:"fas fa-quote-left"},null,-1)),t("span",{class:"comment-text",innerHTML:l(i.notification.comment_content)},null,8,Y)])):c("",!0),i.notification.reply_content?(e(),o("div",Z,[s[1]||(s[1]=t("i",{class:"fas fa-reply"},null,-1)),t("span",{class:"comment-text",innerHTML:l(i.notification.reply_content)},null,8,tt)])):c("",!0)])):c("",!0)]),t("div",it,[i.notification.is_read?c("",!0):(e(),o("button",{key:0,onClick:r,class:"action-btn mark-read-btn",title:"Отметить как прочитанное"},s[2]||(s[2]=[t("i",{class:"fas fa-check"},null,-1)]))),t("button",{onClick:y,class:"action-btn delete-btn",title:"Удалить уведомление"},s[3]||(s[3]=[t("i",{class:"fas fa-trash"},null,-1)]))])]),i.notification.is_read?c("",!0):(e(),o("div",et))],2)}}},nt=$(ot,[["__scopeId","data-v-2e25d2c6"]]),at={class:"notifications-page"},st={class:"container"},ct={class:"notifications-header"},lt={key:0,class:"header-actions"},rt=["disabled"],dt={key:0,class:"loading-container"},ft={key:2,class:"empty-state"},mt={key:3,class:"notifications-list"},ut={__name:"NotificationsPage",setup(i){const n=I(),v=M(),_=T(),f=S(!1),l=E(()=>n.notifications);L(async()=>{if(!v.token){_.push("/login");return}await s(),y()}),B(()=>{m()});let r=null;function y(){r=setInterval(()=>{n.fetchUnreadCount()},1e3*60*5)}function m(){r&&(clearInterval(r),r=null)}async function s(){await n.fetchNotifications()}async function k(){f.value=!0;try{await n.markAsRead()}catch(d){console.error("Error marking all as read:",d)}finally{f.value=!1}}async function p(d){try{await n.markAsRead([d])}catch(a){console.error("Error marking notification as read:",a)}}async function R(d){try{await n.deleteNotification(d)}catch(a){console.error("Error deleting notification:",a)}}return(d,a)=>(e(),o("div",at,[t("div",st,[t("div",ct,[a[1]||(a[1]=t("h1",{class:"page-title"},[t("i",{class:"fas fa-bell"}),b(" Уведомления ")],-1)),l.value.length>0?(e(),o("div",lt,[u(n).unreadCount>0?(e(),o("button",{key:0,onClick:k,class:"btn",disabled:f.value},a[0]||(a[0]=[t("i",{class:"fas fa-check-double"},null,-1),b(" Отметить все как прочитанные ")]),8,rt)):c("",!0)])):c("",!0)]),u(n).loading?(e(),o("div",dt,[g(j),a[2]||(a[2]=t("p",{class:"loading-text"},"Загрузка уведомлений...",-1))])):u(n).error?(e(),x(H,{key:1,message:u(n).error,onRetry:s},null,8,["message"])):l.value.length===0?(e(),o("div",ft,a[3]||(a[3]=[t("i",{class:"fas fa-bell-slash empty-icon"},null,-1),t("h3",{class:"empty-title"},"Нет уведомлений",-1),t("p",{class:"empty-text"}," Когда кто-то ответит на ваш комментарий, вы увидите уведомление здесь ",-1)]))):(e(),o("div",mt,[(e(!0),o(P,null,V(l.value,C=>(e(),x(nt,{key:C.id,notification:C,onMarkRead:p,onDelete:R},null,8,["notification"]))),128))]))])]))}},ht=$(ut,[["__scopeId","data-v-8a1f51b0"]]);export{ht as default};
