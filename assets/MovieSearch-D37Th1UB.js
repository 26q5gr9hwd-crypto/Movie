import{_ as X,r as h,c as q,o as de,a as fe,b as r,d as e,e as F,w as P,T as Q,F as he,f as ge,n as x,g as ye,h as ke,i as o,j as c,k as pe,t as _,l as S,m as K,p as we,q as _e,s as Y,u as me,v as Ie,x as be,y as Se,z as De,A as $e,B as Ce,C as j,D as se,E as oe,G as Me,H as Te,I as Le,J as xe,K as J,L as Ee,M as Ue,N as Fe,O as He,U as le,P as Re,Q as Ne}from"./index-BIce_Eib.js";import{B as Oe}from"./BaseModal-CB0lYaBE.js";import{D as Be,M as ne}from"./MovieList-BJrAACab.js";import{S as Ae}from"./SpinnerLoading-B-b8rxSS.js";import{_ as Ke,a as ie,b as re}from"./icon-imdb-logo-5qtstUwS.js";const Ve={class:"donaters-wrapper"},We={class:"top-donators-carousel"},ze=["href","target","rel"],Je={class:"donor-card-preview"},Ye={key:0,class:"avatar-placeholder"},Pe={key:1,class:"live-badge"},Ge={class:"donor-card-info"},je={class:"donor-name"},qe={key:0,class:"donor-category"},Qe={key:1,class:"donor-status"},Xe={key:2,class:"donor-status offline"},Ze={key:0,class:"donor-link-icon"},et={class:"carousel-indicators"},tt=["onClick"],ue="donatersCache",ce="twitchDataCache",ve=300*1e3,at={__name:"FooterDonaters",setup(u){const I=h([]),D=h(-1),f=h(0),k=h(!1);let s=null,w=null,m=null,l={donaters:null,twitch:null},$=!1;const v=h([{name:"XaksFlaX",twitchUsername:"xaksflax",avatar:null,isLive:!1,category:null,originalIndex:0},{name:"F1ashko",twitchUsername:"f1ashko",avatar:null,isLive:!1,category:null,originalIndex:1},{name:"Krabick",twitchUsername:"krabick",avatar:null,isLive:!1,category:null,originalIndex:2},{name:"Kati",twitchUsername:"Kati",avatar:null,isLive:!1,category:null,originalIndex:3},{name:"Timofey",twitchUsername:"Timofey",avatar:null,isLive:!1,category:null,originalIndex:4}]),T=q(()=>D.value===-1||!I.value.length?"":I.value[D.value]),g=q(()=>v.value.length?v.value[f.value]:null),C=()=>{const y=window.pageYOffset||document.documentElement.scrollTop,i=window.innerHeight,n=document.documentElement.scrollHeight;k.value=y+i>=n-10},M=(y,i)=>{try{return localStorage.getItem(y)}catch(n){return console.warn("localStorage error: ".concat(n.message)),l[i]?JSON.stringify(l[i]):null}},B=(y,i,n)=>{try{localStorage.setItem(y,i)}catch(p){console.warn("localStorage error: ".concat(p.message));try{l[n]=JSON.parse(i)}catch(b){console.error("safeSaveToStorage:",b)}}},N=async()=>{if($)return;const y=M(ce,"twitch");if(y)try{const{timestamp:n,data:p}=JSON.parse(y);if(Date.now()-n<ve){O(p);return}}catch(n){console.error("fetchTwitchData:",n)}const i=v.value.filter(n=>n.twitchUsername).map(n=>n.twitchUsername);if(i.length!==0){$=!0;try{const n=i.map(async U=>{try{const L=await ke(U);if(!L||!L.user_info)return{username:U,isLive:!1,category:null,avatar:null};const W=L.user_info.avatar_url||null;if(L.stream_data&&L.stream_data.length>0){const z=L.stream_data[0];return{username:U,isLive:!0,category:z.game_name||null,avatar:W}}else return{username:U,isLive:!1,category:null,avatar:W}}catch(L){return console.error("Twitch error for ".concat(U,":"),L),{username:U,isLive:!1,category:null,avatar:null}}}),p=await Promise.all(n),b=JSON.stringify({timestamp:Date.now(),data:p});B(ce,b,"twitch"),O(p)}catch(n){console.error("fetchTwitchData:",n)}finally{$=!1}}},O=y=>{v.value=v.value.map(i=>{if(!i.twitchUsername)return i;const n=y.find(p=>p.username.toLowerCase()===i.twitchUsername.toLowerCase());return n?{...i,isLive:n.isLive||!1,category:n.category||null,avatar:n.avatar||i.avatar}:i}).sort((i,n)=>i.isLive!==n.isLive?i.isLive?-1:1:i.originalIndex-n.originalIndex),f.value=0},H=async()=>{const y=new Date().toISOString().split("T")[0],i=M(ue,"donaters");if(i)try{const{date:n,data:p}=JSON.parse(i);if(n===y){I.value=p;return}}catch(n){console.error("fetchDonaters:",n)}try{const n=await ye();I.value=n.split("\n").map(b=>b.trim()).filter(b=>b);const p=JSON.stringify({date:y,data:I.value});B(ue,p,"donaters")}catch(n){console.error("Ошибка загрузки донатеров:",n)}};function R(){if(!I.value.length)return;const y=Math.floor(Math.random()*I.value.length);D.value=y}function A(){I.value.length!==0&&(R(),s=setInterval(R,4e3))}function V(){v.value.length&&(f.value=(f.value+1)%v.value.length)}function E(y){f.value=y,w&&(clearInterval(w),w=setInterval(V,5e3))}function G(){v.value.length!==0&&(w=setInterval(V,5e3))}return de(async()=>{await H(),A(),G(),window.addEventListener("scroll",C),C(),await N(),m=setInterval(N,ve)}),fe(()=>{s&&clearInterval(s),w&&clearInterval(w),m&&clearInterval(m),window.removeEventListener("scroll",C)}),(y,i)=>(o(),r("footer",{class:x({"footer-fixed":!k.value,"footer-static":k.value})},[e("div",Ve,[i[2]||(i[2]=e("span",{class:"donaters-text"},"Спасибо топ донатерам",-1)),e("div",We,[F(Q,{name:"fade",mode:"out-in"},{default:P(()=>[g.value?(o(),r("a",{key:f.value,href:g.value.twitchUsername?"https://twitch.tv/".concat(g.value.twitchUsername):void 0,target:g.value.twitchUsername?"_blank":void 0,rel:g.value.twitchUsername?"noopener noreferrer":void 0,class:x(["donor-card",{"is-live":g.value.isLive,"no-link":!g.value.twitchUsername}])},[e("div",Je,[e("div",{class:"donor-avatar",style:pe({backgroundImage:g.value.avatar?"url(".concat(g.value.avatar,")"):"linear-gradient(135deg, #9147ff 0%, #5a1f99 100%)"})},[g.value.avatar?c("",!0):(o(),r("div",Ye,_(g.value.name.charAt(0).toUpperCase()),1)),g.value.isLive?(o(),r("div",Pe,i[0]||(i[0]=[e("span",{class:"live-indicator"},null,-1),S(" LIVE ")]))):c("",!0)],4)]),e("div",Ge,[e("div",je,_(g.value.name),1),g.value.isLive&&g.value.category?(o(),r("div",qe,_(g.value.category),1)):g.value.isLive?(o(),r("div",Qe,"В эфире")):(o(),r("div",Xe,"Не в сети"))]),g.value.twitchUsername?(o(),r("div",Ze,i[1]||(i[1]=[e("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"14",height:"14"},[e("path",{d:"M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714Z"})],-1)]))):c("",!0)],10,ze)):c("",!0)]),_:1}),e("div",et,[(o(!0),r(he,null,ge(v.value,(n,p)=>(o(),r("button",{key:p,class:x({active:p===f.value}),onClick:b=>E(p)},null,10,tt))),128))])]),i[3]||(i[3]=e("span",{class:"donaters-text"},"а так же",-1)),F(Q,{name:"fade",mode:"out-in"},{default:P(()=>[T.value?(o(),r("span",{key:D.value,class:"donater"},_(T.value),1)):c("",!0)]),_:1})])],2))}},st=X(at,[["__scopeId","data-v-e22a0e66"]]),ot={class:"modal modern-dark-dialog random-movie-modal"},lt={class:"modal-content"},nt={key:0,class:"loading-container"},it={key:1,class:"movie-content"},rt={class:"movie-poster-section"},ut=["alt"],ct={class:"movie-info-section"},vt={class:"movie-title"},dt={key:0,class:"movie-year"},mt={key:1,class:"movie-type"},ft={key:2,class:"movie-countries"},ht={key:3,class:"movie-genres"},gt={class:"ratings"},yt={key:0,class:"rating rating-our"},kt={key:1,class:"rating rating-kp"},pt={key:2,class:"rating rating-imdb"},wt={class:"external-links"},_t=["href"],It=["href"],bt={key:2,class:"error-content"},St={class:"modal-actions"},Dt=["disabled"],$t={__name:"RandomMovieModal",props:{isOpen:Boolean,movie:Object,loading:Boolean,error:String},emits:["close","get-new-movie"],setup(u,{emit:I}){const D=I,f=()=>{D("close")},k=()=>{D("get-new-movie")},s=m=>({"FilmType.FILM":"Фильм","FilmType.TV_SERIES":"Сериал","FilmType.TV_SHOW":"ТВ-шоу","FilmType.MINI_SERIES":"Мини-сериал"})[m]||m,w=m=>{m.target.src="/src/assets/image-no-poster.gif"};return(m,l)=>{const $=we("router-link"),v=_e("lazy");return o(),K(Q,{name:"modal"},{default:P(()=>[u.isOpen?(o(),r("div",{key:0,class:"modal-overlay",onClick:Y(f,["self"])},[e("div",ot,[e("div",{class:"modal-header"},[l[1]||(l[1]=e("h3",null,[e("i",{class:"fas fa-dice"}),S(" Случайный фильм ")],-1)),e("button",{class:"close-btn",onClick:f},l[0]||(l[0]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",lt,[u.loading?(o(),r("div",nt,l[2]||(l[2]=[e("div",{class:"spinner"},null,-1),e("p",null,"Подбираем фильм...",-1)]))):u.movie?(o(),r("div",it,[e("div",rt,[me(e("img",{alt:u.movie.title,class:"movie-poster",onError:w},null,40,ut),[[v,u.movie.cover]])]),e("div",ct,[e("h4",vt,_(u.movie.title),1),u.movie.year?(o(),r("div",dt,_(u.movie.year),1)):c("",!0),u.movie.type?(o(),r("div",mt,_(s(u.movie.type)),1)):c("",!0),u.movie.countries?(o(),r("div",ft,[l[3]||(l[3]=e("strong",null,"Страны:",-1)),S(" "+_(u.movie.countries),1)])):c("",!0),u.movie.genres?(o(),r("div",ht,[l[4]||(l[4]=e("strong",null,"Жанры:",-1)),S(" "+_(u.movie.genres),1)])):c("",!0),e("div",gt,[u.movie.rating_reyohoho?(o(),r("div",yt,[l[5]||(l[5]=e("img",{src:Ke,alt:"ReYohoho",class:"rating-logo"},null,-1)),S(" "+_(u.movie.rating_reyohoho.toFixed(1)),1)])):c("",!0),u.movie.rating_kp?(o(),r("div",kt,[l[6]||(l[6]=e("img",{src:ie,alt:"КП",class:"rating-logo"},null,-1)),S(" "+_(u.movie.rating_kp),1)])):c("",!0),u.movie.rating_imdb?(o(),r("div",pt,[l[7]||(l[7]=e("img",{src:re,alt:"IMDb",class:"rating-logo"},null,-1)),S(" "+_(u.movie.rating_imdb),1)])):c("",!0)]),e("div",wt,[u.movie.url_kp?(o(),r("a",{key:0,href:u.movie.url_kp,target:"_blank",class:"external-link"},l[8]||(l[8]=[e("img",{src:ie,alt:"КП"},null,-1),S(" Кинопоиск ")]),8,_t)):c("",!0),u.movie.url_imdb?(o(),r("a",{key:1,href:u.movie.url_imdb,target:"_blank",class:"external-link"},l[9]||(l[9]=[e("img",{src:re,alt:"IMDb"},null,-1),S(" IMDb ")]),8,It)):c("",!0)])])])):u.error?(o(),r("div",bt,[l[10]||(l[10]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),e("p",null,_(u.error),1)])):c("",!0)]),e("div",St,[e("button",{class:"modern-dark-btn",onClick:f},"Закрыть"),u.movie&&!u.loading?(o(),K($,{key:0,to:{name:"movie-info",params:{kp_id:u.movie.kp_id}},class:"modern-dark-btn primary",onClick:f},{default:P(()=>l[11]||(l[11]=[S(" Посмотреть ")])),_:1},8,["to"])):c("",!0),e("button",{class:"modern-dark-btn primary",disabled:u.loading,onClick:k},l[12]||(l[12]=[e("i",{class:"fas fa-dice"},null,-1),S(" Еще раз ")]),8,Dt)])])])):c("",!0)]),_:1})}}},Ct=X($t,[["__scopeId","data-v-ab41b1b2"]]),Mt={class:"wrapper"},Tt={class:"mainpage"},Lt={class:"search-type-buttons"},xt=["disabled"],Et={class:"search-container"},Ut={class:"input-wrapper"},Ft=["placeholder","inputmode","onKeydown"],Ht={class:"icons"},Rt={class:"content-container"},Nt={key:0},Ot={key:0},Bt={key:0,class:"loading-container"},At={key:1,class:"empty-history"},Kt={key:2},Vt={key:0,class:"no-results"},Wt={key:3,class:"search-prompt"},zt={__name:"MovieSearch",setup(u){const I=Ie(),D=be(),f=Me(),k=h("title"),s=h(""),w=h([]),m=h(!1),l=h(!1),$=h(!1),v=h(""),T=h(null),g=q(()=>I.isMobile),C=h([]),M=h(!1),B=h(""),N=h(!1),O=h(null),H=h(!1),R=h(""),A=h(null);Se(async()=>{if(D.token){m.value=!0;try{C.value=await He(le.HISTORY)}catch(a){const{message:t,code:d}=J(a);v.value=t,T.value=d,console.error("Ошибка загрузки истории:",a),d===401&&(D.logout(),await f.push("/login"),f.go(0))}finally{m.value=!1}}else C.value=I.history});function V(a){C.value=C.value.filter(t=>t.kp_id!==a)}const E=a=>{k.value=a,n(),M.value=!1},G=a=>{if(v.value="",T.value=null,k.value==="title"){if(s.value=a.target.value,g.value)return;M.value=Ee(s.value),M.value&&(B.value=Ue(s.value))}else s.value=a.target.value.replace(/\D+/g,"")},y=()=>{M.value&&(s.value=Re(s.value),M.value=!1)},i=()=>({title:"Введите название фильма",kinopoisk:"Пример: 301 (Матрица)",shikimori:"Пример: 28171 (Повар-боец Сома)",imdb:"Пример: 0198781 (Корпорация монстров)"})[k.value]||"Введите название фильма",n=()=>{var a;s.value="",w.value=[],l.value=!1,M.value=!1,v.value="",T.value=null,(a=A.value)==null||a.focus()},p=()=>{L.cancel(),s.value&&(v.value="",T.value=null,b())},b=async()=>{m.value=!0,l.value=!0,w.value=[];try{if(k.value==="kinopoisk"){/^\d+$/.test(s.value)||(s.value=s.value.replace(/\D/g,"")),f.push({name:"movie-info",params:{kp_id:s.value}});return}if(k.value==="imdb"){/^\d+$/.test(s.value)||(s.value=s.value.replace(/\D/g,""));const a=await Te(s.value);if(a.id_kp)f.push({name:"movie-info",params:{kp_id:"".concat(a.id_kp)}});else throw new Error("Не найдено");return}if(k.value==="shikimori"){/^\d+$/.test(s.value)||(s.value=s.value.replace(/\D/g,""));try{const a=await Le(s.value);if(a.id_kp){f.push({name:"movie-info",params:{kp_id:"".concat(a.id_kp)}});return}}catch(a){console.log("Switch to kodik",a)}f.push({name:"movie-info-shiki",params:{shiki_id:"shiki".concat(s.value)}});return}if(k.value==="title"){const a=await xe(s.value);w.value=a.map(t=>{var d,te,ae;return{...t,kp_id:t.id.toString(),rating_kp:((d=t.raw_data)==null?void 0:d.rating)!=="null"?(te=t.raw_data)==null?void 0:te.rating:null,type:(ae=t.raw_data)==null?void 0:ae.type}})}}catch(a){const{message:t,code:d}=J(a);v.value=t,T.value=d,console.error("Ошибка при поиске:",a)}finally{m.value=!1}},U=async()=>{if(m.value=!0,D.token)try{await Ne(le.HISTORY),C.value=[],m.value=!1,$.value=!1}catch(a){const{message:t,code:d}=J(a);v.value=t,T.value=d,console.error("Ошибка загрузки истории:",a),d===401&&(D.logout(),await f.push("/login"),f.go(0)),m.value=!1,$.value=!1}else I.clearAllHistory(),m.value=!1,$.value=!1},L=De(()=>{s.value.length>=2?b():s.value.length<2&&(w.value=[],l.value=!1)},700);de(()=>{var t;const a=window.location.hash;if(a.startsWith("#search=")){const d=decodeURIComponent(a.replace("#search=",""));s.value=d,b()}else if(a.startsWith("#imdb=")){const d=decodeURIComponent(a.replace("#imdb=",""));E("imdb"),s.value=d,b()}else if(a.startsWith("#shiki")){const d=decodeURIComponent(a.replace("#shiki",""));E("shikimori"),s.value=d,b()}(t=A.value)==null||t.focus()}),$e(s,()=>{k.value==="title"&&L()});const Z=()=>{if(w.value.length>0){const a=document.querySelector(".movie-card");a&&a.focus()}},W=()=>{N.value=!0,z()},ee=()=>{N.value=!1,O.value=null,R.value=""},z=async()=>{H.value=!0,R.value="";try{const a=await Fe();O.value=a}catch(a){const{message:t}=J(a);R.value=t,console.error("Ошибка при получении случайного фильма:",a)}finally{H.value=!1}};return(a,t)=>(o(),r("div",Mt,[e("div",Tt,[e("div",Lt,[e("button",{class:x({active:k.value==="title"}),onClick:t[0]||(t[0]=d=>E("title"))}," Название ",2),e("button",{class:x({active:k.value==="kinopoisk"}),onClick:t[1]||(t[1]=d=>E("kinopoisk"))}," ID Кинопоиск ",2),e("button",{class:x({active:k.value==="shikimori"}),onClick:t[2]||(t[2]=d=>E("shikimori"))}," ID Shikimori ",2),e("button",{class:x({active:k.value==="imdb"}),onClick:t[3]||(t[3]=d=>E("imdb"))}," ID IMDB ",2),e("button",{class:"random-button",onClick:W,disabled:H.value},[t[7]||(t[7]=e("i",{class:"fas fa-dice"},null,-1)),S(" "+_(H.value?"Подбираем...":"Случайный фильм"),1)],8,xt)]),e("div",Et,[e("div",Ut,[me(e("input",{ref_key:"searchInput",ref:A,"onUpdate:modelValue":t[4]||(t[4]=d=>s.value=d),placeholder:i(),class:x(["search-input",{"wrong-layout":M.value}]),inputmode:k.value==="title"?"text":"numeric",onKeydown:[j(Y(p,["prevent"]),["enter"]),j(Y(y,["prevent"]),["tab"]),j(Y(Z,["prevent"]),["down"])],onInput:G},null,42,Ft),[[Ce,s.value]]),e("div",Ht,[s.value?(o(),r("button",{key:0,class:"reset-button",onClick:n},t[8]||(t[8]=[e("i",{class:"fas fa-times"},null,-1)]))):c("",!0),e("button",{class:"search-button",onClick:p},t[9]||(t[9]=[e("i",{class:"fas fa-search"},null,-1)]))]),M.value?(o(),r("div",{key:0,class:x(["layout-warning",{show:M.value}])},[t[10]||(t[10]=e("i",{class:"fas fa-keyboard"},null,-1)),S(" Возможно, вы используете неправильную раскладку. Нажмите Tab для переключения на "+_(B.value)+" раскладку ",1)],2)):c("",!0)])]),e("div",Rt,[s.value?c("",!0):(o(),r("div",Nt,[e("h2",null,[t[11]||(t[11]=S(" История просмотра ")),C.value.length>0?(o(),r("span",Ot,[F(Be,{onClick:t[5]||(t[5]=d=>$.value=!0)}),F(Oe,{"is-open":$.value,message:"Вы уверены, что хотите очистить историю?",onConfirm:U,onClose:t[6]||(t[6]=d=>$.value=!1)},null,8,["is-open"])])):c("",!0)]),m.value?(o(),r("div",Bt,[F(Ae)])):C.value.length===0?(o(),r("div",At,t[12]||(t[12]=[e("span",{class:"material-icons"},"movie",-1),e("p",null,"Здесь пока пусто",-1)]))):(o(),K(se(ne),{key:2,"movies-list":C.value,"is-history":!0,loading:!1,onItemDeleted:V},null,8,["movies-list"]))])),!s.value&&v.value?(o(),K(oe,{key:1,message:v.value,code:T.value},null,8,["message","code"])):c("",!0),l.value?(o(),r("div",Kt,[t[13]||(t[13]=e("h2",null,"Результаты поиска",-1)),F(se(ne),{"movies-list":w.value,"is-history":!1,loading:m.value},null,8,["movies-list","loading"]),w.value.length===0&&!m.value&&!v.value?(o(),r("div",Vt," Ничего не найдено ")):c("",!0),v.value?(o(),K(oe,{key:1,message:v.value,code:T.value},null,8,["message","code"])):c("",!0)])):c("",!0),s.value&&!l.value&&!m.value&&!v.value?(o(),r("div",Wt,' Нажмите кнопку "Поиск" или Enter для поиска ')):c("",!0)])]),F(st),F(Ct,{"is-open":N.value,movie:O.value,loading:H.value,error:R.value,onClose:ee,onGetNewMovie:z},null,8,["is-open","movie","loading","error"])]))}},qt=X(zt,[["__scopeId","data-v-05c02d79"]]);export{qt as default};
