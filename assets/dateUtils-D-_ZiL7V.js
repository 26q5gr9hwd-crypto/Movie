import{al as b}from"./index-CXMST_Dj.js";function x(){const t=r=>{try{const n=new URL(r);return n.hostname==="cdn.7tv.app"&&n.protocol==="https:"||n.pathname.includes("/api/7tv")&&n.protocol==="https:"?"".concat(b()).concat(n.pathname).concat(n.search).concat(n.hash):(console.warn("URL изображения отклонен:",{url:r,hostname:n.hostname,protocol:n.protocol,reason:n.hostname!=="cdn.7tv.app"?"неразрешенный домен":"неразрешенный протокол"}),!1)}catch(n){return console.warn("Недопустимый URL изображения:",r,"Ошибка:",n.message),!1}},l=r=>{const n=document.createElement("div");return n.textContent=r,n.innerHTML},g=r=>{if(!r)return"";let n=r;return n=n.replace(/\[spoiler\]\s*\[\/spoiler\]/g,""),n=n.replace(/\[img\]\s*\[\/img\]/g,""),n=n.replace(/\[link=[^\]]+\]\s*\[\/link\]/g,""),n=n.replace(/\[img\](.*?)\[\/img\]/g,(u,a)=>{const e=a.trim(),i=t(e);if(i&&i!==!1){const o=l(i);return'<img src="'.concat(o,'" alt="7TV emote" class="inline-emoji" loading="lazy" />')}return"[недопустимое изображение: ".concat(l(e),"]")}),n=n.replace(new RegExp("\\[spoiler\\](.*?)\\[\\/spoiler\\]","gs"),(u,a,e,i)=>{const o=l(a.trim());if(!o)return"";const c=e>0?i[e-1]:" ",s=e+u.length<i.length?i[e+u.length]:" ",f=c&&c!==" "&&c!=="\n"&&c!=="	",m=s&&s!==" "&&s!=="\n"&&s!=="	",p=f?" ":"",I=m?" ":"";return"".concat(p,'<span class="spoiler-text" onclick="this.classList.toggle(\'revealed\')" title="Нажмите, чтобы показать спойлер">').concat(o,"</span>").concat(I)}),n=n.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(u,a,e)=>{const i=a.trim(),o=e.trim();if(!o)return"";if(/^https?:\/\/.+/.test(i)&&o){const s=l(i),f=l(o);return'<a href="'.concat(s,'" target="_blank" rel="noopener noreferrer" class="comment-link">').concat(f,"</a>")}return l(o||i)}),n};return{formatContent:g,formatContentWithTruncation:(r,n=500,u=!1)=>{if(!r)return"";let a=r;if(r.length>n&&!u){let e=r.slice(0,n);const o=(r.match(/\[img\].*?\[\/img\]/g)||[]).length,c=(e.match(/\[img\].*?\[\/img\]/g)||[]).length,s=o-c,f=e.lastIndexOf("[img]"),m=e.lastIndexOf("[/img]");f>m&&f!==-1&&(e=r.slice(0,f)),e=e.trim();const p=["[img","[im","[i","["];for(const $ of p)if(e.endsWith($)){const d=e.lastIndexOf("[");if(d!==-1){e=e.slice(0,d).trim();break}}const I=["[/img","[/im","[/i","[/"];for(const $ of I)if(e.endsWith($)){const d=e.lastIndexOf("[");if(d!==-1){e=e.slice(0,d).trim();break}}let C="...";s>0&&(C="... (+".concat(s," ").concat(s===1?"изображение":"изображений",")")),a=e+C}return g(a)},isValidImageUrl:t,escapeHtml:l}}const O=t=>{if(!t)return"";const l=t.substring(0,4),g=t.substring(4,6),h=t.substring(6,8),r=t.substring(9,11),n=t.substring(11,13),u=t.substring(13,15);return new Date(Date.UTC(parseInt(l),parseInt(g)-1,parseInt(h),parseInt(r),parseInt(n),parseInt(u))).toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone})},R=t=>{if(!t)return"";const l=t.substring(0,4),g=t.substring(4,6),h=t.substring(6,8),r=t.substring(9,11),n=t.substring(11,13),u=t.substring(13,15),a=new Date(Date.UTC(parseInt(l),parseInt(g)-1,parseInt(h),parseInt(r),parseInt(n),parseInt(u))),i=Math.floor((new Date-a)/1e3);if(i<60)return"только что";const o=Math.floor(i/60);if(o<60)return"".concat(o," ").concat(T(o)," назад");const c=Math.floor(o/60);if(c<24)return"".concat(c," ").concat(U(c)," назад");const s=Math.floor(c/24);if(s<7)return"".concat(s," ").concat(D(s)," назад");const f=Math.floor(s/7);if(f<4)return"".concat(f," ").concat(M(f)," назад");const m=Math.floor(s/30);if(m<12)return"".concat(m," ").concat(W(m)," назад");const p=Math.floor(s/365);return"".concat(p," ").concat(k(p)," назад")},T=t=>t%10===1&&t%100!==11?"минуту":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"минуты":"минут",U=t=>t%10===1&&t%100!==11?"час":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"часа":"часов",D=t=>t%10===1&&t%100!==11?"день":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"дня":"дней",M=t=>t%10===1&&t%100!==11?"неделю":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"недели":"недель",W=t=>t%10===1&&t%100!==11?"месяц":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"месяца":"месяцев",k=t=>t%10===1&&t%100!==11?"год":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"года":"лет";export{O as a,R as f,x as u};
