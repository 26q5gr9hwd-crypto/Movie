import{$ as T}from"./index-CsZVjhWA.js";function L(){let t=null;const p=async()=>(t||(t=await T()),t),m=r=>{try{const n=new URL(r);return n.hostname==="cdn.7tv.app"&&n.protocol==="https:"||n.pathname.includes("/api/7tv")&&n.protocol==="https:"?t?"".concat(t).concat(n.pathname).concat(n.search).concat(n.hash):r:(console.warn("URL изображения отклонен:",{url:r,hostname:n.hostname,protocol:n.protocol,reason:n.hostname!=="cdn.7tv.app"?"неразрешенный домен":"неразрешенный протокол"}),!1)}catch(n){return console.warn("Недопустимый URL изображения:",r,"Ошибка:",n.message),!1}},c=r=>{const n=document.createElement("div");return n.textContent=r,n.innerHTML},g=r=>{if(!r)return"";let n=r;return n=n.replace(/\[spoiler\]\s*\[\/spoiler\]/g,""),n=n.replace(/\[img\]\s*\[\/img\]/g,""),n=n.replace(/\[link=[^\]]+\]\s*\[\/link\]/g,""),n=n.replace(/\[img\](.*?)\[\/img\]/g,(f,a)=>{const e=a.trim(),i=m(e);if(i&&i!==!1){const s=c(i);return'<img src="'.concat(s,'" alt="7TV emote" class="inline-emoji" loading="lazy" />')}return"[недопустимое изображение: ".concat(c(e),"]")}),n=n.replace(new RegExp("\\[spoiler\\](.*?)\\[\\/spoiler\\]","gs"),(f,a,e,i)=>{const s=c(a.trim());if(!s)return"";const l=e>0?i[e-1]:" ",o=e+f.length<i.length?i[e+f.length]:" ",u=l&&l!==" "&&l!=="\n"&&l!=="	",I=o&&o!==" "&&o!=="\n"&&o!=="	",$=u?" ":"",C=I?" ":"";return"".concat($,'<span class="spoiler-text" onclick="this.classList.toggle(\'revealed\')" title="Нажмите, чтобы показать спойлер">').concat(s,"</span>").concat(C)}),n=n.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(f,a,e)=>{const i=a.trim(),s=e.trim();if(!s)return"";if(/^https?:\/\/.+/.test(i)&&s){const o=c(i),u=c(s);return'<a href="'.concat(o,'" target="_blank" rel="noopener noreferrer" class="comment-link">').concat(u,"</a>")}return c(s||i)}),n};return{formatContent:g,formatContentWithTruncation:(r,n=500,f=!1)=>{if(!r)return"";let a=r;if(r.length>n&&!f){let e=r.slice(0,n);const s=(r.match(/\[img\].*?\[\/img\]/g)||[]).length,l=(e.match(/\[img\].*?\[\/img\]/g)||[]).length,o=s-l,u=e.lastIndexOf("[img]"),I=e.lastIndexOf("[/img]");u>I&&u!==-1&&(e=r.slice(0,u)),e=e.trim();const $=["[img","[im","[i","["];for(const b of $)if(e.endsWith(b)){const d=e.lastIndexOf("[");if(d!==-1){e=e.slice(0,d).trim();break}}const C=["[/img","[/im","[/i","[/"];for(const b of C)if(e.endsWith(b)){const d=e.lastIndexOf("[");if(d!==-1){e=e.slice(0,d).trim();break}}let U="...";o>0&&(U="... (+".concat(o," ").concat(o===1?"изображение":"изображений",")")),a=e+U}return g(a)},isValidImageUrl:m,escapeHtml:c,initializeBaseURL:p}}const O=t=>{if(!t)return"";const p=t.substring(0,4),m=t.substring(4,6),c=t.substring(6,8),g=t.substring(9,11),h=t.substring(11,13),r=t.substring(13,15);return new Date(Date.UTC(parseInt(p),parseInt(m)-1,parseInt(c),parseInt(g),parseInt(h),parseInt(r))).toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone})},B=t=>{if(!t)return"";const p=t.substring(0,4),m=t.substring(4,6),c=t.substring(6,8),g=t.substring(9,11),h=t.substring(11,13),r=t.substring(13,15),n=new Date(Date.UTC(parseInt(p),parseInt(m)-1,parseInt(c),parseInt(g),parseInt(h),parseInt(r))),a=Math.floor((new Date-n)/1e3);if(a<60)return"только что";const e=Math.floor(a/60);if(e<60)return"".concat(e," ").concat(D(e)," назад");const i=Math.floor(e/60);if(i<24)return"".concat(i," ").concat(M(i)," назад");const s=Math.floor(i/24);if(s<7)return"".concat(s," ").concat(W(s)," назад");const l=Math.floor(s/7);if(l<4)return"".concat(l," ").concat(k(l)," назад");const o=Math.floor(s/30);if(o<12)return"".concat(o," ").concat(v(o)," назад");const u=Math.floor(s/365);return"".concat(u," ").concat(x(u)," назад")},D=t=>t%10===1&&t%100!==11?"минуту":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"минуты":"минут",M=t=>t%10===1&&t%100!==11?"час":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"часа":"часов",W=t=>t%10===1&&t%100!==11?"день":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"дня":"дней",k=t=>t%10===1&&t%100!==11?"неделю":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"недели":"недель",v=t=>t%10===1&&t%100!==11?"месяц":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"месяца":"месяцев",x=t=>t%10===1&&t%100!==11?"год":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"года":"лет";export{O as a,B as f,L as u};
