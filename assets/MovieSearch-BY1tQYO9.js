import{_ as N,r as v,c as F,o as R,a as L,b as g,d as m,e as l,f as w,w as P,g as _,t as Y,T as W,h as z,u as J,i as j,j as q,k as Q,l as G,n as S,m as X,v as Z,p as ee,q as ae,s as $,x as te,E as se,y as le,z as oe,A as ne,B as re,C as D,D as ie,U as x,F as ue}from"./index-DZEIjBEU.js";import{B as ce}from"./BaseModal-R-J3Vzxy.js";import{D as ve,M as B}from"./MovieList-BS-ulJ5P.js";const de={class:"donaters-wrapper"},A="donatersCache",pe={__name:"FooterDonaters",setup(U){const i=v([]),f=v(-1);let u=null;const o=F(()=>f.value===-1||!i.value.length?"":i.value[f.value]),t=async()=>{const c=new Date().toISOString().split("T")[0],d=localStorage.getItem(A);if(d)try{const{date:r,data:p}=JSON.parse(d);if(r===c){i.value=p;return}}catch(r){console.error("Ошибка кэша донатеров:",r)}try{const r=await z();i.value=r.split("\n").map(p=>p.trim()).filter(p=>p),localStorage.setItem(A,JSON.stringify({date:c,data:i.value}))}catch(r){console.error("Ошибка загрузки донатеров:",r)}};function h(){if(!i.value.length)return;const c=Math.floor(Math.random()*i.value.length);f.value=c}function n(){i.value.length!==0&&(h(),u=setInterval(h,4e3))}return R(async()=>{await t(),n()}),L(()=>{u&&clearInterval(u)}),(c,d)=>(m(),g("footer",null,[l("div",de,[w(W,{name:"fade",mode:"out-in"},{default:P(()=>[o.value?(m(),g("span",{key:f.value,class:"donater"},Y(o.value),1)):_("",!0)]),_:1})])]))}},fe=N(pe,[["__scopeId","data-v-5dec4e96"]]),he={class:"wrapper"},me={class:"mainpage"},ge={class:"search-type-buttons"},ke={class:"search-container"},_e={class:"input-wrapper"},ye=["placeholder","inputmode"],we={class:"icons"},Ie={class:"content-container"},Se={key:0},De={key:1},Ce={key:0,class:"no-results"},be={key:2,class:"search-prompt"},Me={__name:"MovieSearch",setup(U){const i=J(),f=j(),u=le(),o=v("title"),t=v(""),h=v([]),n=v(!1),c=v(!1),d=v(!1),r=v(""),p=v(null),k=v([]);q(async()=>{if(n.value=!0,f.token)try{k.value=await ie(x.HISTORY),n.value=!1}catch(a){const{message:e,code:s}=D(a);r.value=e,p.value=s,console.error("Ошибка загрузки истории:",a),s===401&&(f.logout(),await u.push("/login"),u.go(0)),n.value=!1}else k.value=i.history,n.value=!1});function H(a){k.value=k.value.filter(e=>e.kp_id!==a)}const y=a=>{o.value=a,C()},K=a=>{o.value==="title"?t.value=a.target.value:t.value=a.target.value.replace(/\D+/g,"")},O=()=>({title:"Введите название фильма",kinopoisk:"Пример: 301 (Матрица)",shikimori:"Пример: 28171 (Повар-боец Сома)",imdb:"Пример: 0198781 (Корпорация монстров)"})[o.value]||"Введите название фильма",C=()=>{t.value="",h.value=[],c.value=!1},b=()=>{M.cancel(),t.value?I():alert("Введите запрос для поиска")},I=async()=>{n.value=!0,c.value=!0,h.value=[];try{if(o.value==="kinopoisk"){/^\d+$/.test(t.value)||(t.value=t.value.replace(/\D/g,"")),u.push({name:"movie-info",params:{kp_id:t.value}});return}if(o.value==="imdb"){/^\d+$/.test(t.value)||(t.value=t.value.replace(/\D/g,""));const a=await oe(t.value);if(a.id_kp)u.push({name:"movie-info",params:{kp_id:"".concat(a.id_kp)}});else throw new Error("Не найдено");return}if(o.value==="shikimori"){/^\d+$/.test(t.value)||(t.value=t.value.replace(/\D/g,""));const a=await ne(t.value);if(a.id_kp)u.push({name:"movie-info",params:{kp_id:"".concat(a.id_kp)}});else throw new Error("Не найдено");return}if(o.value==="title"){const a=await re(t.value);h.value=a.map(e=>{var s,E,T;return{...e,kp_id:e.id.toString(),rating_kp:((s=e.raw_data)==null?void 0:s.rating)!=="null"?(E=e.raw_data)==null?void 0:E.rating:null,type:(T=e.raw_data)==null?void 0:T.type}})}}catch(a){const{message:e,code:s}=D(a);r.value=e,p.value=s,console.error("Ошибка при поиске:",a)}finally{n.value=!1}},V=async()=>{if(n.value=!0,f.token)try{await ue(x.HISTORY),k.value=[],n.value=!1,d.value=!1}catch(a){const{message:e,code:s}=D(a);r.value=e,p.value=s,console.error("Ошибка загрузки истории:",a),s===401&&(f.logout(),await u.push("/login"),u.go(0)),n.value=!1,d.value=!1}else i.clearAllHistory(),n.value=!1,d.value=!1},M=Q(()=>{t.value.length>=3?I():t.value.length<3&&(h.value=[],c.value=!1)},700);return R(()=>{const a=window.location.hash;if(a.startsWith("#search=")){const e=decodeURIComponent(a.replace("#search=",""));t.value=e,I()}else if(a.startsWith("#imdb=")){const e=decodeURIComponent(a.replace("#imdb=",""));y("imdb"),t.value=e,I()}else if(a.startsWith("#shiki")){const e=decodeURIComponent(a.replace("#shiki",""));y("shikimori"),t.value=e,I()}}),G(t,()=>{o.value==="title"&&M()}),(a,e)=>(m(),g("div",he,[l("div",me,[l("div",ge,[l("button",{class:S({active:o.value==="title"}),onClick:e[0]||(e[0]=s=>y("title"))}," Название ",2),l("button",{class:S({active:o.value==="kinopoisk"}),onClick:e[1]||(e[1]=s=>y("kinopoisk"))}," ID Кинопоиск ",2),l("button",{class:S({active:o.value==="shikimori"}),onClick:e[2]||(e[2]=s=>y("shikimori"))}," ID Shikimori ",2),l("button",{class:S({active:o.value==="imdb"}),onClick:e[3]||(e[3]=s=>y("imdb"))}," ID IMDB ",2)]),l("div",ke,[l("div",_e,[X(l("input",{ref:"searchInput","onUpdate:modelValue":e[4]||(e[4]=s=>t.value=s),placeholder:O(),class:"search-input",inputmode:o.value==="title"?"text":"numeric",onKeydown:ee(b,["enter"]),onInput:K},null,40,ye),[[Z,t.value]]),l("div",we,[t.value?(m(),g("button",{key:0,class:"reset-button",onClick:C},e[7]||(e[7]=[l("i",{class:"fas fa-times"},null,-1)]))):_("",!0),l("button",{class:"search-button",onClick:b},e[8]||(e[8]=[l("i",{class:"fas fa-search"},null,-1)]))])])]),l("div",Ie,[!t.value&&k.value.length>0?(m(),g("div",Se,[l("h2",null,[e[9]||(e[9]=ae(" История просмотра ")),l("span",null,[w(ve,{onClick:e[5]||(e[5]=s=>d.value=!0)}),w(ce,{"is-open":d.value,message:"Вы уверены, что хотите очистить историю?",onConfirm:V,onClose:e[6]||(e[6]=s=>d.value=!1)},null,8,["is-open"])])]),w($(B),{"movies-list":k.value,"is-history":!0,loading:n.value,onItemDeleted:H},null,8,["movies-list","loading"])])):_("",!0),c.value?(m(),g("div",De,[e[10]||(e[10]=l("h2",null,"Результаты поиска",-1)),w($(B),{"movies-list":h.value,"is-history":!1,loading:n.value},null,8,["movies-list","loading"]),h.value.length===0&&!n.value&&!r.value?(m(),g("div",Ce," Ничего не найдено ")):_("",!0),r.value?(m(),te(se,{key:1,message:r.value,code:p.value},null,8,["message","code"])):_("",!0)])):_("",!0),t.value&&!c.value&&!n.value&&!r.value?(m(),g("div",be,' Нажмите кнопку "Поиск" или Enter для поиска ')):_("",!0)])]),w(fe)]))}},xe=N(Me,[["__scopeId","data-v-607ecc0c"]]);export{xe as default};
//# sourceMappingURL=MovieSearch-BY1tQYO9.js.map
