function k(){const t=r=>{try{const n=new URL(r),i=n.hostname==="cdn.7tv.app"&&n.protocol==="https:"||n.pathname.includes("/api/7tv")&&n.protocol==="https:";return i||console.warn("URL изображения отклонен:",{url:r,hostname:n.hostname,protocol:n.protocol,reason:n.hostname!=="cdn.7tv.app"?"неразрешенный домен":"неразрешенный протокол"}),i}catch(n){return console.warn("Недопустимый URL изображения:",r,"Ошибка:",n.message),!1}},l=r=>{const n=document.createElement("div");return n.textContent=r,n.innerHTML},g=r=>{if(!r)return"";let n=r;return n=n.replace(/\[spoiler\]\s*\[\/spoiler\]/g,""),n=n.replace(/\[img\]\s*\[\/img\]/g,""),n=n.replace(/\[link=[^\]]+\]\s*\[\/link\]/g,""),n=n.replace(/\[img\](.*?)\[\/img\]/g,(i,u)=>{const e=u.trim();if(t(e)){const c=l(e);return'<img src="'.concat(c,'" alt="7TV emote" class="inline-emoji" loading="lazy" />')}return"[недопустимое изображение: ".concat(l(e),"]")}),n=n.replace(new RegExp("\\[spoiler\\](.*?)\\[\\/spoiler\\]","gs"),(i,u,e,c)=>{const o=l(u.trim());if(!o)return"";const a=e>0?c[e-1]:" ",s=e+i.length<c.length?c[e+i.length]:" ",f=a&&a!==" "&&a!=="\n"&&a!=="	",m=s&&s!==" "&&s!=="\n"&&s!=="	",p=f?" ":"",I=m?" ":"";return"".concat(p,'<span class="spoiler-text" onclick="this.classList.toggle(\'revealed\')" title="Нажмите, чтобы показать спойлер">').concat(o,"</span>").concat(I)}),n=n.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(i,u,e)=>{const c=u.trim(),o=e.trim();if(!o)return"";if(/^https?:\/\/.+/.test(c)&&o){const s=l(c),f=l(o);return'<a href="'.concat(s,'" target="_blank" rel="noopener noreferrer" class="comment-link">').concat(f,"</a>")}return l(o||c)}),n};return{formatContent:g,formatContentWithTruncation:(r,n=300,i=!1)=>{if(!r)return"";let u=r;if(r.length>n&&!i){let e=r.slice(0,n);const o=(r.match(/\[img\].*?\[\/img\]/g)||[]).length,a=(e.match(/\[img\].*?\[\/img\]/g)||[]).length,s=o-a,f=e.lastIndexOf("[img]"),m=e.lastIndexOf("[/img]");f>m&&f!==-1&&(e=r.slice(0,f)),e=e.trim();const p=["[img","[im","[i","["];for(const $ of p)if(e.endsWith($)){const d=e.lastIndexOf("[");if(d!==-1){e=e.slice(0,d).trim();break}}const I=["[/img","[/im","[/i","[/"];for(const $ of I)if(e.endsWith($)){const d=e.lastIndexOf("[");if(d!==-1){e=e.slice(0,d).trim();break}}let C="...";s>0&&(C="... (+".concat(s," ").concat(s===1?"изображение":"изображений",")")),u=e+C}return g(u)},isValidImageUrl:t,escapeHtml:l}}const v=t=>{if(!t)return"";const l=t.substring(0,4),g=t.substring(4,6),h=t.substring(6,8),r=t.substring(9,11),n=t.substring(11,13),i=t.substring(13,15);return new Date(Date.UTC(parseInt(l),parseInt(g)-1,parseInt(h),parseInt(r),parseInt(n),parseInt(i))).toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone})},x=t=>{if(!t)return"";const l=t.substring(0,4),g=t.substring(4,6),h=t.substring(6,8),r=t.substring(9,11),n=t.substring(11,13),i=t.substring(13,15),u=new Date(Date.UTC(parseInt(l),parseInt(g)-1,parseInt(h),parseInt(r),parseInt(n),parseInt(i))),c=Math.floor((new Date-u)/1e3);if(c<60)return"только что";const o=Math.floor(c/60);if(o<60)return"".concat(o," ").concat(b(o)," назад");const a=Math.floor(o/60);if(a<24)return"".concat(a," ").concat(T(a)," назад");const s=Math.floor(a/24);if(s<7)return"".concat(s," ").concat(D(s)," назад");const f=Math.floor(s/7);if(f<4)return"".concat(f," ").concat(U(f)," назад");const m=Math.floor(s/30);if(m<12)return"".concat(m," ").concat(M(m)," назад");const p=Math.floor(s/365);return"".concat(p," ").concat(W(p)," назад")},b=t=>t%10===1&&t%100!==11?"минуту":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"минуты":"минут",T=t=>t%10===1&&t%100!==11?"час":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"часа":"часов",D=t=>t%10===1&&t%100!==11?"день":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"дня":"дней",U=t=>t%10===1&&t%100!==11?"неделю":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"недели":"недель",M=t=>t%10===1&&t%100!==11?"месяц":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"месяца":"месяцев",W=t=>t%10===1&&t%100!==11?"год":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"года":"лет";export{v as a,x as f,k as u};
