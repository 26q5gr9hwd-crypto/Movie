import{_ as $,a2 as M,b as n,d as e,e as t,g as c,f as h,w as C,s as b,t as g,y as u,n as p,an as A,i as I,r as L,c as S,o as E,z as T,a as B,x,E as H,L as P,M as V}from"./index-CY9NJ3NK.js";import{f as q,u as z}from"./dateUtils-Bn-E5LvO.js";import{S as D}from"./SpinnerLoading-CQVxOTdQ.js";const F={class:"notification-content"},U={key:0,class:"movie-poster"},j=["src","alt"],O={class:"notification-main"},G={class:"notification-header"},J={class:"notification-info"},K={class:"notification-time"},Q={class:"notification-message"},W={key:0,class:"comment-preview"},X={key:0,class:"original-comment"},Y=["innerHTML"],Z={key:1,class:"reply-comment"},tt=["innerHTML"],it={class:"notification-actions"},et={key:0,class:"unread-indicator"},nt={__name:"NotificationItem",props:{notification:{type:Object,required:!0}},emits:["mark-read","delete"],setup(i,{emit:o}){const v=i,_=o,{formatContent:f}=z(),l=m=>m?f(m):"",r=()=>{_("mark-read",v.notification.id)},y=()=>{_("delete",v.notification.id)};return(m,s)=>{const k=M("router-link");return e(),n("div",{class:p(["notification-item",{unread:!i.notification.is_read,read:i.notification.is_read}])},[t("div",F,[i.notification.movie_cover?(e(),n("div",U,[h(k,{to:"/movie/".concat(i.notification.movie_id)},{default:C(()=>[t("img",{src:i.notification.movie_cover,alt:i.notification.movie_title,class:"poster-img"},null,8,j)]),_:1},8,["to"])])):c("",!0),t("div",O,[t("div",G,[t("div",J,[h(k,{to:"/movie/".concat(i.notification.movie_id),class:"movie-title"},{default:C(()=>[b(g(i.notification.movie_title),1)]),_:1},8,["to"])]),t("div",K,g(u(q)(i.notification.created_at)),1)]),t("div",Q,g(i.notification.message),1),i.notification.comment_content||i.notification.reply_content?(e(),n("div",W,[i.notification.comment_content?(e(),n("div",X,[s[0]||(s[0]=t("i",{class:"fas fa-quote-left"},null,-1)),t("span",{class:"comment-text",innerHTML:l(i.notification.comment_content)},null,8,Y)])):c("",!0),i.notification.reply_content?(e(),n("div",Z,[s[1]||(s[1]=t("i",{class:"fas fa-reply"},null,-1)),t("span",{class:"comment-text",innerHTML:l(i.notification.reply_content)},null,8,tt)])):c("",!0)])):c("",!0)]),t("div",it,[i.notification.is_read?c("",!0):(e(),n("button",{key:0,onClick:r,class:"action-btn mark-read-btn",title:"Отметить как прочитанное"},s[2]||(s[2]=[t("i",{class:"fas fa-check"},null,-1)]))),t("button",{onClick:y,class:"action-btn delete-btn",title:"Удалить уведомление"},s[3]||(s[3]=[t("i",{class:"fas fa-trash"},null,-1)]))])]),i.notification.is_read?c("",!0):(e(),n("div",et))],2)}}},ot=$(nt,[["__scopeId","data-v-2e25d2c6"]]),at={class:"notifications-page"},st={class:"container"},ct={class:"notifications-header"},lt={key:0,class:"header-actions"},rt=["disabled"],dt={key:0,class:"loading-container"},ft={key:2,class:"empty-state"},mt={key:3,class:"notifications-list"},ut={__name:"NotificationsPage",setup(i){const o=A(),v=I(),_=T(),f=L(!1),l=S(()=>o.notifications);E(async()=>{if(!v.token){_.push("/login");return}await s(),y()}),B(()=>{m()});let r=null;function y(){r=setInterval(()=>{o.fetchUnreadCount()},3e4)}function m(){r&&(clearInterval(r),r=null)}async function s(){await o.fetchNotifications()}async function k(){f.value=!0;try{await o.markAsRead()}catch(d){console.error("Error marking all as read:",d)}finally{f.value=!1}}async function R(d){try{await o.markAsRead([d])}catch(a){console.error("Error marking notification as read:",a)}}async function w(d){try{await o.deleteNotification(d)}catch(a){console.error("Error deleting notification:",a)}}return(d,a)=>(e(),n("div",at,[t("div",st,[t("div",ct,[a[1]||(a[1]=t("h1",{class:"page-title"},[t("i",{class:"fas fa-bell"}),b(" Уведомления ")],-1)),l.value.length>0?(e(),n("div",lt,[u(o).unreadCount>0?(e(),n("button",{key:0,onClick:k,class:"btn",disabled:f.value},a[0]||(a[0]=[t("i",{class:"fas fa-check-double"},null,-1),b(" Отметить все как прочитанные ")]),8,rt)):c("",!0)])):c("",!0)]),u(o).loading?(e(),n("div",dt,[h(D),a[2]||(a[2]=t("p",{class:"loading-text"},"Загрузка уведомлений...",-1))])):u(o).error?(e(),x(H,{key:1,message:u(o).error,onRetry:s},null,8,["message"])):l.value.length===0?(e(),n("div",ft,a[3]||(a[3]=[t("i",{class:"fas fa-bell-slash empty-icon"},null,-1),t("h3",{class:"empty-title"},"Нет уведомлений",-1),t("p",{class:"empty-text"}," Когда кто-то ответит на ваш комментарий, вы увидите уведомление здесь ",-1)]))):(e(),n("div",mt,[(e(!0),n(P,null,V(l.value,N=>(e(),x(ot,{key:N.id,notification:N,onMarkRead:R,onDelete:w},null,8,["notification"]))),128))]))])]))}},yt=$(ut,[["__scopeId","data-v-0c5e6811"]]);export{yt as default};
