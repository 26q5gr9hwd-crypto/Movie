import{_ as x,i as w,b as o,d as e,e as t,g as c,f as h,w as C,m as b,t as g,A as u,n as A,ay as I,q as M,r as S,c as E,o as L,B as T,a as B,k as $,E as P,O as H,P as V}from"./index-DsiLFmX4.js";import{f as q}from"./dateUtils-BVcL52pq.js";import{u as D}from"./useCommentFormatting-CgNCueVN.js";import{S as F}from"./SpinnerLoading-B0434bHO.js";const O={class:"notification-content"},U={key:0,class:"movie-poster"},j=["src","alt"],z={class:"notification-main"},G={class:"notification-header"},J={class:"notification-info"},K={class:"notification-time"},Q={class:"notification-message"},W={key:0,class:"comment-preview"},X={key:0,class:"original-comment"},Y=["innerHTML"],Z={key:1,class:"reply-comment"},tt=["innerHTML"],it={class:"notification-actions"},et={key:0,class:"unread-indicator"},ot={__name:"NotificationItem",props:{notification:{type:Object,required:!0}},emits:["mark-read","delete"],setup(i,{emit:n}){const v=i,_=n,{formatContent:f}=D(),l=m=>m?f(m):"",r=()=>{_("mark-read",v.notification.id)},y=()=>{_("delete",v.notification.id)};return(m,s)=>{const k=w("router-link");return e(),o("div",{class:A(["notification-item",{unread:!i.notification.is_read,read:i.notification.is_read}])},[t("div",O,[i.notification.movie_cover?(e(),o("div",U,[h(k,{to:"/movie/".concat(i.notification.movie_id)},{default:C(()=>[t("img",{src:i.notification.movie_cover,alt:i.notification.movie_title,class:"poster-img"},null,8,j)]),_:1},8,["to"])])):c("",!0),t("div",z,[t("div",G,[t("div",J,[h(k,{to:"/movie/".concat(i.notification.movie_id),class:"movie-title"},{default:C(()=>[b(g(i.notification.movie_title),1)]),_:1},8,["to"])]),t("div",K,g(u(q)(i.notification.created_at)),1)]),t("div",Q,g(i.notification.message),1),i.notification.comment_content||i.notification.reply_content?(e(),o("div",W,[i.notification.comment_content?(e(),o("div",X,[s[0]||(s[0]=t("i",{class:"fas fa-quote-left"},null,-1)),t("span",{class:"comment-text",innerHTML:l(i.notification.comment_content)},null,8,Y)])):c("",!0),i.notification.reply_content?(e(),o("div",Z,[s[1]||(s[1]=t("i",{class:"fas fa-reply"},null,-1)),t("span",{class:"comment-text",innerHTML:l(i.notification.reply_content)},null,8,tt)])):c("",!0)])):c("",!0)]),t("div",it,[i.notification.is_read?c("",!0):(e(),o("button",{key:0,onClick:r,class:"action-btn mark-read-btn",title:"Отметить как прочитанное"},s[2]||(s[2]=[t("i",{class:"fas fa-check"},null,-1)]))),t("button",{onClick:y,class:"action-btn delete-btn",title:"Удалить уведомление"},s[3]||(s[3]=[t("i",{class:"fas fa-trash"},null,-1)]))])]),i.notification.is_read?c("",!0):(e(),o("div",et))],2)}}},nt=x(ot,[["__scopeId","data-v-2e25d2c6"]]),at={class:"notifications-page"},st={class:"container"},ct={class:"notifications-header"},lt={key:0,class:"header-actions"},rt=["disabled"],dt={key:0,class:"loading-container"},ft={key:2,class:"empty-state"},mt={key:3,class:"notifications-list"},ut={__name:"NotificationsPage",setup(i){const n=I(),v=M(),_=T(),f=S(!1),l=E(()=>n.notifications);L(async()=>{if(!v.token){_.push("/login");return}await s(),y()}),B(()=>{m()});let r=null;function y(){r=setInterval(()=>{n.fetchUnreadCount()},3e4)}function m(){r&&(clearInterval(r),r=null)}async function s(){await n.fetchNotifications()}async function k(){f.value=!0;try{await n.markAsRead()}catch(d){console.error("Error marking all as read:",d)}finally{f.value=!1}}async function R(d){try{await n.markAsRead([d])}catch(a){console.error("Error marking notification as read:",a)}}async function p(d){try{await n.deleteNotification(d)}catch(a){console.error("Error deleting notification:",a)}}return(d,a)=>(e(),o("div",at,[t("div",st,[t("div",ct,[a[1]||(a[1]=t("h1",{class:"page-title"},[t("i",{class:"fas fa-bell"}),b(" Уведомления ")],-1)),l.value.length>0?(e(),o("div",lt,[u(n).unreadCount>0?(e(),o("button",{key:0,onClick:k,class:"btn",disabled:f.value},a[0]||(a[0]=[t("i",{class:"fas fa-check-double"},null,-1),b(" Отметить все как прочитанные ")]),8,rt)):c("",!0)])):c("",!0)]),u(n).loading?(e(),o("div",dt,[h(F),a[2]||(a[2]=t("p",{class:"loading-text"},"Загрузка уведомлений...",-1))])):u(n).error?(e(),$(P,{key:1,message:u(n).error,onRetry:s},null,8,["message"])):l.value.length===0?(e(),o("div",ft,a[3]||(a[3]=[t("i",{class:"fas fa-bell-slash empty-icon"},null,-1),t("h3",{class:"empty-title"},"Нет уведомлений",-1),t("p",{class:"empty-text"}," Когда кто-то ответит на ваш комментарий, вы увидите уведомление здесь ",-1)]))):(e(),o("div",mt,[(e(!0),o(H,null,V(l.value,N=>(e(),$(nt,{key:N.id,notification:N,onMarkRead:R,onDelete:p},null,8,["notification"]))),128))]))])]))}},gt=x(ut,[["__scopeId","data-v-0c5e6811"]]);export{gt as default};
