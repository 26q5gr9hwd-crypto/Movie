import{ao as V}from"./index-DrU3v8Uu.js";function z(){const t=r=>{try{const n=new URL(r);return n.hostname==="cdn.7tv.app"&&n.protocol==="https:"||n.pathname.includes("/api/7tv")&&n.protocol==="https:"?"".concat(V()).concat(n.pathname).concat(n.search).concat(n.hash):(console.warn("URL изображения отклонен:",{url:r,hostname:n.hostname,protocol:n.protocol,reason:n.hostname!=="cdn.7tv.app"?"неразрешенный домен":"неразрешенный протокол"}),!1)}catch(n){return console.warn("Недопустимый URL изображения:",r,"Ошибка:",n.message),!1}},e=r=>{const n=document.createElement("div");return n.textContent=r,n.innerHTML},d=r=>{if(!r)return"";let n=r;return n=n.replace(/\[spoiler\]\s*\[\/spoiler\]/g,""),n=n.replace(/\[img\]\s*\[\/img\]/g,""),n=n.replace(/\[link=[^\]]+\]\s*\[\/link\]/g,""),n=n.replace(new RegExp("\\[spoiler\\](.*?)\\[\\/spoiler\\]","gs"),(c,a,i,s)=>{const o=a.trim();if(!o)return"";const f=o.split(/(\[img\].*?\[\/img\]|\[link=.*?\[\/link\])/).filter(Boolean).map($=>$.startsWith("[img]")?$.replace(/\[img\](.*?)\[\/img\]/g,(M,b)=>{const I=b.trim(),p=t(I);if(p&&p!==!1){const h=e(p);return'<span class="spoiler-hidden-content"><img src="'.concat(h,'" alt="7TV emote" class="inline-emoji" loading="lazy" /></span>')}return"[недопустимое изображение: ".concat(e(I),"]")}):$.startsWith("[link=")?$.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(M,b,I)=>{const p=b.trim(),h=I.trim();if(!h)return"";if(/^https?:\/\//.test(p)&&h){const W=e(p),v=e(h);return'<a href="'.concat(W,'" target="_blank" rel="noopener noreferrer" class="comment-link">').concat(v,"</a>")}return e(h||p)}):e($)).join(""),u=i>0?s[i-1]:" ",m=i+c.length<s.length?s[i+c.length]:" ",T=u&&u!==" "&&u!=="\n"&&u!=="	",k=m&&m!==" "&&m!=="\n"&&m!=="	",C=T?" ":"",D=k?" ":"";return"".concat(C,'<span class="spoiler-text" onclick="this.classList.toggle(\'revealed\')" title="Нажмите, чтобы показать спойлер">').concat(f,"</span>").concat(D)}),n=n.replace(/\[img\](.*?)\[\/img\]/g,(c,a)=>{const i=a.trim(),s=t(i);if(s&&s!==!1){const o=e(s);return'<img src="'.concat(o,'" alt="7TV emote" class="inline-emoji" loading="lazy" />')}return"[недопустимое изображение: ".concat(e(i),"]")}),n=n.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(c,a,i)=>{const s=a.trim(),o=i.trim();if(!o)return"";if(/^https?:\/\//.test(s)&&o){const l=e(s),f=e(o);return'<a href="'.concat(l,'" target="_blank" rel="noopener noreferrer" class="comment-link">').concat(f,"</a>")}return e(o||s)}),n};return{formatContent:d,formatContentWithTruncation:r=>r?d(r):"",isValidImageUrl:t,escapeHtml:e}}const A=t=>{if(!t)return"";const e=t.substring(0,4),d=t.substring(4,6),U=t.substring(6,8),r=t.substring(9,11),n=t.substring(11,13),c=t.substring(13,15);return new Date(Date.UTC(parseInt(e),parseInt(d)-1,parseInt(U),parseInt(r),parseInt(n),parseInt(c))).toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone})},F=t=>{if(!t)return"";const e=t.substring(0,4),d=t.substring(4,6),U=t.substring(6,8),r=t.substring(9,11),n=t.substring(11,13),c=t.substring(13,15),a=new Date(Date.UTC(parseInt(e),parseInt(d)-1,parseInt(U),parseInt(r),parseInt(n),parseInt(c))),s=Math.floor((new Date-a)/1e3);if(s<60)return"только что";const o=Math.floor(s/60);if(o<60)return"".concat(o," ").concat(x(o)," назад");const g=Math.floor(o/60);if(g<24)return"".concat(g," ").concat(R(g)," назад");const l=Math.floor(g/24);if(l<7)return"".concat(l," ").concat(L(l)," назад");const f=Math.floor(l/7);if(f<4)return"".concat(f," ").concat(y(f)," назад");const u=Math.floor(l/30);if(u<12)return"".concat(u," ").concat(w(u)," назад");const m=Math.floor(l/365);return"".concat(m," ").concat(j(m)," назад")},x=t=>t%10===1&&t%100!==11?"минуту":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"минуты":"минут",R=t=>t%10===1&&t%100!==11?"час":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"часа":"часов",L=t=>t%10===1&&t%100!==11?"день":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"дня":"дней",y=t=>t%10===1&&t%100!==11?"неделю":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"недели":"недель",w=t=>t%10===1&&t%100!==11?"месяц":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"месяца":"месяцев",j=t=>t%10===1&&t%100!==11?"год":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"года":"лет";export{A as a,F as f,z as u};
