import{_ as A,r as m,c as ee,o as te,a as de,b as i,d as e,e as S,w as O,T as ae,n as C,g as me,f as n,h as v,t as w,i as T,j as fe,k as ge,l as L,m as p,p as se,u as he,q as ke,s as ye,v as pe,x as be,y as we,z as N,A as J,E as j,B as _e,C as Ie,D as Me,F as Se,G as R,H as Ce,I as $e,J as De,K as Ee,U as q,L as Te,M as xe}from"./index-DLchalay.js";import{B as Re}from"./BaseModal-BLLjIyUF.js";import{D as Le,M as G}from"./MovieList-BzP7AsCe.js";import{S as Be}from"./SpinnerLoading-D6kyjXjw.js";import{_ as He,a as Q,b as X}from"./icon-imdb-logo-5qtstUwS.js";const Fe={class:"donaters-wrapper"},Z="donatersCache",Ne={__name:"FooterDonaters",setup(l){const g=m([]),b=m(-1),f=m(!1);let d=null;const s=ee(()=>b.value===-1||!g.value.length?"":g.value[b.value]),y=()=>{const u=window.pageYOffset||document.documentElement.scrollTop,h=window.innerHeight,_=document.documentElement.scrollHeight;f.value=u+h>=_-10},c=async()=>{const u=new Date().toISOString().split("T")[0],h=localStorage.getItem(Z);if(h)try{const{date:_,data:k}=JSON.parse(h);if(_===u){g.value=k;return}}catch(_){console.error("Ошибка кэша донатеров:",_)}try{const _=await me();g.value=_.split("\n").map(k=>k.trim()).filter(k=>k),localStorage.setItem(Z,JSON.stringify({date:u,data:g.value}))}catch(_){console.error("Ошибка загрузки донатеров:",_)}};function o(){if(!g.value.length)return;const u=Math.floor(Math.random()*g.value.length);b.value=u}function I(){g.value.length!==0&&(o(),d=setInterval(o,4e3))}return te(async()=>{await c(),I(),window.addEventListener("scroll",y),y()}),de(()=>{d&&clearInterval(d),window.removeEventListener("scroll",y)}),(u,h)=>(n(),i("footer",{class:C({"footer-fixed":!f.value,"footer-static":f.value})},[e("div",Fe,[S(ae,{name:"fade",mode:"out-in"},{default:O(()=>[s.value?(n(),i("span",{key:b.value,class:"donater"},w(s.value),1)):v("",!0)]),_:1})])],2))}},Oe=A(Ne,[["__scopeId","data-v-1babf189"]]),Ae={class:"modal modern-dark-dialog random-movie-modal"},Ke={class:"modal-content"},Ue={key:0,class:"loading-container"},Ve={key:1,class:"movie-content"},Ye={class:"movie-poster-section"},We=["alt"],ze={class:"movie-info-section"},Pe={class:"movie-title"},Je={key:0,class:"movie-year"},je={key:1,class:"movie-type"},qe={key:2,class:"movie-countries"},Ge={key:3,class:"movie-genres"},Qe={class:"ratings"},Xe={key:0,class:"rating rating-our"},Ze={key:1,class:"rating rating-kp"},et={key:2,class:"rating rating-imdb"},tt={class:"external-links"},at=["href"],st=["href"],ot={key:2,class:"error-content"},lt={class:"modal-actions"},nt=["disabled"],it={__name:"RandomMovieModal",props:{isOpen:Boolean,movie:Object,loading:Boolean,error:String},emits:["close","get-new-movie"],setup(l,{emit:g}){const b=g,f=()=>{b("close")},d=()=>{b("get-new-movie")},s=c=>({"FilmType.FILM":"Фильм","FilmType.TV_SERIES":"Сериал","FilmType.TV_SHOW":"ТВ-шоу","FilmType.MINI_SERIES":"Мини-сериал"})[c]||c,y=c=>{c.target.src="/src/assets/image-no-poster.gif"};return(c,o)=>{const I=fe("router-link"),u=ge("lazy");return n(),T(ae,{name:"modal"},{default:O(()=>[l.isOpen?(n(),i("div",{key:0,class:"modal-overlay",onClick:L(f,["self"])},[e("div",Ae,[e("div",{class:"modal-header"},[o[1]||(o[1]=e("h3",null,[e("i",{class:"fas fa-dice"}),p(" Случайный фильм ")],-1)),e("button",{class:"close-btn",onClick:f},o[0]||(o[0]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",Ke,[l.loading?(n(),i("div",Ue,o[2]||(o[2]=[e("div",{class:"spinner"},null,-1),e("p",null,"Подбираем фильм...",-1)]))):l.movie?(n(),i("div",Ve,[e("div",Ye,[se(e("img",{alt:l.movie.title,class:"movie-poster",onError:y},null,40,We),[[u,l.movie.cover]])]),e("div",ze,[e("h4",Pe,w(l.movie.title),1),l.movie.year?(n(),i("div",Je,w(l.movie.year),1)):v("",!0),l.movie.type?(n(),i("div",je,w(s(l.movie.type)),1)):v("",!0),l.movie.countries?(n(),i("div",qe,[o[3]||(o[3]=e("strong",null,"Страны:",-1)),p(" "+w(l.movie.countries),1)])):v("",!0),l.movie.genres?(n(),i("div",Ge,[o[4]||(o[4]=e("strong",null,"Жанры:",-1)),p(" "+w(l.movie.genres),1)])):v("",!0),e("div",Qe,[l.movie.rating_reyohoho?(n(),i("div",Xe,[o[5]||(o[5]=e("img",{src:He,alt:"ReYohoho",class:"rating-logo"},null,-1)),p(" "+w(l.movie.rating_reyohoho.toFixed(1)),1)])):v("",!0),l.movie.rating_kp?(n(),i("div",Ze,[o[6]||(o[6]=e("img",{src:Q,alt:"КП",class:"rating-logo"},null,-1)),p(" "+w(l.movie.rating_kp),1)])):v("",!0),l.movie.rating_imdb?(n(),i("div",et,[o[7]||(o[7]=e("img",{src:X,alt:"IMDb",class:"rating-logo"},null,-1)),p(" "+w(l.movie.rating_imdb),1)])):v("",!0)]),e("div",tt,[l.movie.url_kp?(n(),i("a",{key:0,href:l.movie.url_kp,target:"_blank",class:"external-link"},o[8]||(o[8]=[e("img",{src:Q,alt:"КП"},null,-1),p(" Кинопоиск ")]),8,at)):v("",!0),l.movie.url_imdb?(n(),i("a",{key:1,href:l.movie.url_imdb,target:"_blank",class:"external-link"},o[9]||(o[9]=[e("img",{src:X,alt:"IMDb"},null,-1),p(" IMDb ")]),8,st)):v("",!0)])])])):l.error?(n(),i("div",ot,[o[10]||(o[10]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),e("p",null,w(l.error),1)])):v("",!0)]),e("div",lt,[e("button",{class:"modern-dark-btn",onClick:f},"Закрыть"),l.movie&&!l.loading?(n(),T(I,{key:0,to:{name:"movie-info",params:{kp_id:l.movie.kp_id}},class:"modern-dark-btn primary",onClick:f},{default:O(()=>o[11]||(o[11]=[p(" Посмотреть ")])),_:1},8,["to"])):v("",!0),e("button",{class:"modern-dark-btn primary",disabled:l.loading,onClick:d},o[12]||(o[12]=[e("i",{class:"fas fa-dice"},null,-1),p(" Еще раз ")]),8,nt)])])])):v("",!0)]),_:1})}}},rt=A(it,[["__scopeId","data-v-ab41b1b2"]]),ut={class:"wrapper"},vt={class:"mainpage"},ct={class:"search-type-buttons"},dt=["disabled"],mt={class:"search-container"},ft={class:"input-wrapper"},gt=["placeholder","inputmode","onKeydown"],ht={class:"icons"},kt={class:"content-container"},yt={key:0},pt={key:0},bt={key:0,class:"loading-container"},wt={key:1,class:"empty-history"},_t={key:2},It={key:0,class:"no-results"},Mt={key:3,class:"search-prompt"},St={__name:"MovieSearch",setup(l){const g=he(),b=ke(),f=_e(),d=m("title"),s=m(""),y=m([]),c=m(!1),o=m(!1),I=m(!1),u=m(""),h=m(null),_=ee(()=>g.isMobile),k=m([]),M=m(!1),K=m(""),B=m(!1),H=m(null),D=m(!1),x=m(""),F=m(null);ye(async()=>{if(b.token){c.value=!0;try{k.value=await Ee(q.HISTORY)}catch(a){const{message:t,code:r}=R(a);u.value=t,h.value=r,console.error("Ошибка загрузки истории:",a),r===401&&(b.logout(),await f.push("/login"),f.go(0))}finally{c.value=!1}}else k.value=g.history});function oe(a){k.value=k.value.filter(t=>t.kp_id!==a)}const $=a=>{d.value=a,U(),M.value=!1},le=a=>{if(u.value="",h.value=null,d.value==="title"){if(s.value=a.target.value,_.value)return;M.value=Ce(s.value),M.value&&(K.value=$e(s.value))}else s.value=a.target.value.replace(/\D+/g,"")},ne=()=>{M.value&&(s.value=Te(s.value),M.value=!1)},ie=()=>({title:"Введите название фильма",kinopoisk:"Пример: 301 (Матрица)",shikimori:"Пример: 28171 (Повар-боец Сома)",imdb:"Пример: 0198781 (Корпорация монстров)"})[d.value]||"Введите название фильма",U=()=>{var a;s.value="",y.value=[],o.value=!1,M.value=!1,u.value="",h.value=null,(a=F.value)==null||a.focus()},V=()=>{Y.cancel(),s.value&&(u.value="",h.value=null,E())},E=async()=>{c.value=!0,o.value=!0,y.value=[];try{if(d.value==="kinopoisk"){/^\d+$/.test(s.value)||(s.value=s.value.replace(/\D/g,"")),f.push({name:"movie-info",params:{kp_id:s.value}});return}if(d.value==="imdb"){/^\d+$/.test(s.value)||(s.value=s.value.replace(/\D/g,""));const a=await Ie(s.value);if(a.id_kp)f.push({name:"movie-info",params:{kp_id:"".concat(a.id_kp)}});else throw new Error("Не найдено");return}if(d.value==="shikimori"){/^\d+$/.test(s.value)||(s.value=s.value.replace(/\D/g,""));try{const a=await Me(s.value);if(a.id_kp){f.push({name:"movie-info",params:{kp_id:"".concat(a.id_kp)}});return}}catch(a){console.log("Switch to kodik",a)}f.push({name:"movie-info-shiki",params:{shiki_id:"shiki".concat(s.value)}});return}if(d.value==="title"){const a=await Se(s.value);y.value=a.map(t=>{var r,z,P;return{...t,kp_id:t.id.toString(),rating_kp:((r=t.raw_data)==null?void 0:r.rating)!=="null"?(z=t.raw_data)==null?void 0:z.rating:null,type:(P=t.raw_data)==null?void 0:P.type}})}}catch(a){const{message:t,code:r}=R(a);u.value=t,h.value=r,console.error("Ошибка при поиске:",a)}finally{c.value=!1}},re=async()=>{if(c.value=!0,b.token)try{await xe(q.HISTORY),k.value=[],c.value=!1,I.value=!1}catch(a){const{message:t,code:r}=R(a);u.value=t,h.value=r,console.error("Ошибка загрузки истории:",a),r===401&&(b.logout(),await f.push("/login"),f.go(0)),c.value=!1,I.value=!1}else g.clearAllHistory(),c.value=!1,I.value=!1},Y=pe(()=>{s.value.length>=2?E():s.value.length<2&&(y.value=[],o.value=!1)},700);te(()=>{var t;const a=window.location.hash;if(a.startsWith("#search=")){const r=decodeURIComponent(a.replace("#search=",""));s.value=r,E()}else if(a.startsWith("#imdb=")){const r=decodeURIComponent(a.replace("#imdb=",""));$("imdb"),s.value=r,E()}else if(a.startsWith("#shiki")){const r=decodeURIComponent(a.replace("#shiki",""));$("shikimori"),s.value=r,E()}(t=F.value)==null||t.focus()}),be(s,()=>{d.value==="title"&&Y()});const ue=()=>{if(y.value.length>0){const a=document.querySelector(".movie-card");a&&a.focus()}},ve=()=>{B.value=!0,W()},ce=()=>{B.value=!1,H.value=null,x.value=""},W=async()=>{D.value=!0,x.value="";try{const a=await De();H.value=a}catch(a){const{message:t}=R(a);x.value=t,console.error("Ошибка при получении случайного фильма:",a)}finally{D.value=!1}};return(a,t)=>(n(),i("div",ut,[e("div",vt,[e("div",ct,[e("button",{class:C({active:d.value==="title"}),onClick:t[0]||(t[0]=r=>$("title"))}," Название ",2),e("button",{class:C({active:d.value==="kinopoisk"}),onClick:t[1]||(t[1]=r=>$("kinopoisk"))}," ID Кинопоиск ",2),e("button",{class:C({active:d.value==="shikimori"}),onClick:t[2]||(t[2]=r=>$("shikimori"))}," ID Shikimori ",2),e("button",{class:C({active:d.value==="imdb"}),onClick:t[3]||(t[3]=r=>$("imdb"))}," ID IMDB ",2),e("button",{class:"random-button",onClick:ve,disabled:D.value},[t[7]||(t[7]=e("i",{class:"fas fa-dice"},null,-1)),p(" "+w(D.value?"Подбираем...":"Случайный фильм"),1)],8,dt)]),e("div",mt,[e("div",ft,[se(e("input",{ref_key:"searchInput",ref:F,"onUpdate:modelValue":t[4]||(t[4]=r=>s.value=r),placeholder:ie(),class:C(["search-input",{"wrong-layout":M.value}]),inputmode:d.value==="title"?"text":"numeric",onKeydown:[N(L(V,["prevent"]),["enter"]),N(L(ne,["prevent"]),["tab"]),N(L(ue,["prevent"]),["down"])],onInput:le},null,42,gt),[[we,s.value]]),e("div",ht,[s.value?(n(),i("button",{key:0,class:"reset-button",onClick:U},t[8]||(t[8]=[e("i",{class:"fas fa-times"},null,-1)]))):v("",!0),e("button",{class:"search-button",onClick:V},t[9]||(t[9]=[e("i",{class:"fas fa-search"},null,-1)]))]),M.value?(n(),i("div",{key:0,class:C(["layout-warning",{show:M.value}])},[t[10]||(t[10]=e("i",{class:"fas fa-keyboard"},null,-1)),p(" Возможно, вы используете неправильную раскладку. Нажмите Tab для переключения на "+w(K.value)+" раскладку ",1)],2)):v("",!0)])]),e("div",kt,[s.value?v("",!0):(n(),i("div",yt,[e("h2",null,[t[11]||(t[11]=p(" История просмотра ")),k.value.length>0?(n(),i("span",pt,[S(Le,{onClick:t[5]||(t[5]=r=>I.value=!0)}),S(Re,{"is-open":I.value,message:"Вы уверены, что хотите очистить историю?",onConfirm:re,onClose:t[6]||(t[6]=r=>I.value=!1)},null,8,["is-open"])])):v("",!0)]),c.value?(n(),i("div",bt,[S(Be)])):k.value.length===0?(n(),i("div",wt,t[12]||(t[12]=[e("span",{class:"material-icons"},"movie",-1),e("p",null,"Здесь пока пусто",-1)]))):(n(),T(J(G),{key:2,"movies-list":k.value,"is-history":!0,loading:!1,onItemDeleted:oe},null,8,["movies-list"]))])),!s.value&&u.value?(n(),T(j,{key:1,message:u.value,code:h.value},null,8,["message","code"])):v("",!0),o.value?(n(),i("div",_t,[t[13]||(t[13]=e("h2",null,"Результаты поиска",-1)),S(J(G),{"movies-list":y.value,"is-history":!1,loading:c.value},null,8,["movies-list","loading"]),y.value.length===0&&!c.value&&!u.value?(n(),i("div",It," Ничего не найдено ")):v("",!0),u.value?(n(),T(j,{key:1,message:u.value,code:h.value},null,8,["message","code"])):v("",!0)])):v("",!0),s.value&&!o.value&&!c.value&&!u.value?(n(),i("div",Mt,' Нажмите кнопку "Поиск" или Enter для поиска ')):v("",!0)])]),S(Oe),S(rt,{"is-open":B.value,movie:H.value,loading:D.value,error:x.value,onClose:ce,onGetNewMovie:W},null,8,["is-open","movie","loading","error"])]))}},xt=A(St,[["__scopeId","data-v-05c02d79"]]);export{xt as default};
