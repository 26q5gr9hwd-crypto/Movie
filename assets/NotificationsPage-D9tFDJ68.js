import{_ as p,z as x,b as e,d as n,e as t,g as c,t as h,y as k,n as R,ak as M,i as A,r as I,c as L,o as S,a as T,x as N,s as C,f as w,E,K as B,L as H}from"./index-CaM0XL5B.js";import{f as P,u as V}from"./dateUtils-NQ-DwdGR.js";import{S as q}from"./SpinnerLoading-BOWmwwu7.js";const z={class:"notification-content"},D={key:0,class:"movie-poster"},F=["src","alt"],U={class:"notification-main"},j={class:"notification-header"},K={class:"notification-info"},O={class:"notification-time"},G={class:"notification-message"},J={key:0,class:"comment-preview"},Q={key:0,class:"original-comment"},W=["innerHTML"],X={key:1,class:"reply-comment"},Y=["innerHTML"],Z={class:"notification-actions"},tt={key:0,class:"unread-indicator"},it={__name:"NotificationItem",props:{notification:{type:Object,required:!0}},emits:["mark-read","delete"],setup(i,{emit:o}){const d=i,y=o,f=x(),{formatContent:m}=V(),l=v=>v?m(v):"",_=()=>{y("mark-read",d.notification.id)},g=()=>{y("delete",d.notification.id)},u=()=>{f.push("/movie/".concat(d.notification.movie_id))};return(v,s)=>(n(),e("div",{class:R(["notification-item",{unread:!i.notification.is_read,read:i.notification.is_read}])},[t("div",z,[i.notification.movie_cover?(n(),e("div",D,[t("img",{src:i.notification.movie_cover,alt:i.notification.movie_title,class:"poster-img",onClick:u},null,8,F)])):c("",!0),t("div",U,[t("div",j,[t("div",K,[t("span",{class:"movie-title",onClick:u},h(i.notification.movie_title),1)]),t("div",O,h(k(P)(i.notification.created_at)),1)]),t("div",G,h(i.notification.message),1),i.notification.comment_content||i.notification.reply_content?(n(),e("div",J,[i.notification.comment_content?(n(),e("div",Q,[s[0]||(s[0]=t("i",{class:"fas fa-quote-left"},null,-1)),t("span",{class:"comment-text",innerHTML:l(i.notification.comment_content)},null,8,W)])):c("",!0),i.notification.reply_content?(n(),e("div",X,[s[1]||(s[1]=t("i",{class:"fas fa-reply"},null,-1)),t("span",{class:"comment-text",innerHTML:l(i.notification.reply_content)},null,8,Y)])):c("",!0)])):c("",!0)]),t("div",Z,[i.notification.is_read?c("",!0):(n(),e("button",{key:0,onClick:_,class:"action-btn mark-read-btn",title:"Отметить как прочитанное"},s[2]||(s[2]=[t("i",{class:"fas fa-check"},null,-1)]))),t("button",{onClick:g,class:"action-btn delete-btn",title:"Удалить уведомление"},s[3]||(s[3]=[t("i",{class:"fas fa-trash"},null,-1)]))])]),i.notification.is_read?c("",!0):(n(),e("div",tt))],2))}},nt=p(it,[["__scopeId","data-v-45af7189"]]),et={class:"notifications-page"},ot={class:"container"},at={class:"notifications-header"},st={key:0,class:"header-actions"},ct=["disabled"],lt={key:0,class:"loading-container"},rt={key:2,class:"empty-state"},dt={key:3,class:"notifications-list"},ft={__name:"NotificationsPage",setup(i){const o=M(),d=A(),y=x(),f=I(!1),m=L(()=>o.notifications);S(async()=>{if(!d.token){y.push("/login");return}await u(),_()}),T(()=>{g()});let l=null;function _(){l=setInterval(()=>{o.fetchUnreadCount()},3e4)}function g(){l&&(clearInterval(l),l=null)}async function u(){await o.fetchNotifications()}async function v(){f.value=!0;try{await o.markAsRead()}catch(r){console.error("Error marking all as read:",r)}finally{f.value=!1}}async function s(r){try{await o.markAsRead([r])}catch(a){console.error("Error marking notification as read:",a)}}async function $(r){try{await o.deleteNotification(r)}catch(a){console.error("Error deleting notification:",a)}}return(r,a)=>(n(),e("div",et,[t("div",ot,[t("div",at,[a[1]||(a[1]=t("h1",{class:"page-title"},[t("i",{class:"fas fa-bell"}),C(" Уведомления ")],-1)),m.value.length>0?(n(),e("div",st,[k(o).unreadCount>0?(n(),e("button",{key:0,onClick:v,class:"btn",disabled:f.value},a[0]||(a[0]=[t("i",{class:"fas fa-check-double"},null,-1),C(" Отметить все как прочитанные ")]),8,ct)):c("",!0)])):c("",!0)]),k(o).loading?(n(),e("div",lt,[w(q),a[2]||(a[2]=t("p",{class:"loading-text"},"Загрузка уведомлений...",-1))])):k(o).error?(n(),N(E,{key:1,message:k(o).error,onRetry:u},null,8,["message"])):m.value.length===0?(n(),e("div",rt,a[3]||(a[3]=[t("i",{class:"fas fa-bell-slash empty-icon"},null,-1),t("h3",{class:"empty-title"},"Нет уведомлений",-1),t("p",{class:"empty-text"}," Когда кто-то ответит на ваш комментарий, вы увидите уведомление здесь ",-1)]))):(n(),e("div",dt,[(n(!0),e(B,null,H(m.value,b=>(n(),N(nt,{key:b.id,notification:b,onMarkRead:s,onDelete:$},null,8,["notification"]))),128))]))])]))}},kt=p(ft,[["__scopeId","data-v-0c5e6811"]]);export{kt as default};
