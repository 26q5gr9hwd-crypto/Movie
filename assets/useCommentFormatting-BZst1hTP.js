import{au as v}from"./index-BK3dZJXG.js";const H=t=>{if(!t)return"";const e=t.substring(0,4),u=t.substring(4,6),p=t.substring(6,8),r=t.substring(9,11),n=t.substring(11,13),a=t.substring(13,15);return new Date(Date.UTC(parseInt(e),parseInt(u)-1,parseInt(p),parseInt(r),parseInt(n),parseInt(a))).toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone})},A=t=>{if(!t)return"";const e=t.substring(0,4),u=t.substring(4,6),p=t.substring(6,8),r=t.substring(9,11),n=t.substring(11,13),a=t.substring(13,15),c=new Date(Date.UTC(parseInt(e),parseInt(u)-1,parseInt(p),parseInt(r),parseInt(n),parseInt(a))),o=Math.floor((new Date-c)/1e3);if(o<60)return"только что";const s=Math.floor(o/60);if(s<60)return"".concat(s," ").concat(R(s)," назад");const m=Math.floor(s/60);if(m<24)return"".concat(m," ").concat(V(m)," назад");const l=Math.floor(m/24);if(l<7)return"".concat(l," ").concat(L(l)," назад");const i=Math.floor(l/7);if(i<4)return"".concat(i," ").concat(w(i)," назад");const d=Math.floor(l/30);if(d<12)return"".concat(d," ").concat(y(d)," назад");const g=Math.floor(l/365);return"".concat(g," ").concat(S(g)," назад")},R=t=>t%10===1&&t%100!==11?"минуту":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"минуты":"минут",V=t=>t%10===1&&t%100!==11?"час":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"часа":"часов",L=t=>t%10===1&&t%100!==11?"день":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"дня":"дней",w=t=>t%10===1&&t%100!==11?"неделю":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"недели":"недель",y=t=>t%10===1&&t%100!==11?"месяц":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"месяца":"месяцев",S=t=>t%10===1&&t%100!==11?"год":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"года":"лет";function z(t){const e=[],u=t.replace(/\[[^\]]*\d+[^\]]*\]/g,""),p=/(\d{1,2}:)?\d{1,2}:\d{2}|\d{1,2}:\d{2}/g,r=[...u.matchAll(p)];if(r.length>0){let n=0;for(;n<r.length;){const a=r[n][0];let c=null;u.slice(r[n].index+a.length).match(/^[\s,\-–—]+/)&&r[n+1]?(c=r[n+1][0],n+=2):n+=1;const o=l=>{if(!l)return null;const i=l.split(":").map(Number);return i.length===3?i[0]*3600+i[1]*60+i[2]:i.length===2?i[0]*60+i[1]:i.length===1?i[0]:null},s=o(a),m=o(c);s!==null&&m!==null?e.push([Math.max(0,s-2),m+2]):s!==null&&e.push([Math.max(0,s-2),s+5])}}return e}function F(t){const e=Math.floor(t/3600),u=Math.floor(t%3600/60),p=Math.floor(t%60);return"".concat(e.toString().padStart(2,"0"),":").concat(u.toString().padStart(2,"0"),":").concat(p.toString().padStart(2,"0"))}function O(){const t=r=>{try{const n=new URL(r);return n.hostname==="cdn.7tv.app"&&n.protocol==="https:"||n.pathname.includes("/api/7tv")&&n.protocol==="https:"?"".concat(v()).concat(n.pathname).concat(n.search).concat(n.hash):(console.warn("URL изображения отклонен:",{url:r,hostname:n.hostname,protocol:n.protocol,reason:n.hostname!=="cdn.7tv.app"?"неразрешенный домен":"неразрешенный протокол"}),!1)}catch(n){return console.warn("Недопустимый URL изображения:",r,"Ошибка:",n.message),!1}},e=r=>{const n=document.createElement("div");return n.textContent=r,n.innerHTML},u=r=>{if(!r)return"";let n=r;return n=n.replace(/\[spoiler\]\s*\[\/spoiler\]/g,""),n=n.replace(/\[img\]\s*\[\/img\]/g,""),n=n.replace(/\[link=[^\]]+\]\s*\[\/link\]/g,""),n=n.replace(new RegExp("\\[spoiler\\](.*?)\\[\\/spoiler\\]","gs"),(a,c,f,o)=>{const s=c.trim();if(!s)return"";const i=s.split(/(\[img\].*?\[\/img\]|\[link=.*?\[\/link\])/).filter(Boolean).map(U=>U.startsWith("[img]")?U.replace(/\[img\](.*?)\[\/img\]/g,(C,T)=>{const I=T.trim(),h=t(I);if(h&&h!==!1){const $=e(h);return'<span class="spoiler-hidden-content"><img src="'.concat($,'" alt="7TV emote" class="inline-emoji" loading="lazy" /></span>')}return"[недопустимое изображение: ".concat(e(I),"]")}):U.startsWith("[link=")?U.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(C,T,I)=>{const h=T.trim(),$=I.trim();if(!$)return"";if(/^https?:\/\//.test(h)&&$){const D=e(h),W=e($);return'<a href="'.concat(D,'" target="_blank" rel="noopener noreferrer" class="comment-link">').concat(W,"</a>")}return e($||h)}):e(U)).join(""),d=f>0?o[f-1]:" ",g=f+a.length<o.length?o[f+a.length]:" ",b=d&&d!==" "&&d!=="\n"&&d!=="	",M=g&&g!==" "&&g!=="\n"&&g!=="	",x=b?" ":"",k=M?" ":"";return"".concat(x,'<span class="spoiler-text" onclick="this.classList.toggle(\'revealed\')" title="Нажмите, чтобы показать спойлер">').concat(i,"</span>").concat(k)}),n=n.replace(/\[img\](.*?)\[\/img\]/g,(a,c)=>{const f=c.trim(),o=t(f);if(o&&o!==!1){const s=e(o);return'<img src="'.concat(s,'" alt="7TV emote" class="inline-emoji" loading="lazy" />')}return"[недопустимое изображение: ".concat(e(f),"]")}),n=n.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(a,c,f)=>{const o=c.trim(),s=f.trim();if(!s)return"";if(/^https?:\/\//.test(o)&&s){const l=e(o),i=e(s);return'<a href="'.concat(l,'" target="_blank" rel="noopener noreferrer" class="comment-link">').concat(i,"</a>")}return e(s||o)}),n};return{formatContent:u,formatContentWithTruncation:r=>r?u(r):"",isValidImageUrl:t,escapeHtml:e}}export{A as a,H as b,F as f,z as p,O as u};
