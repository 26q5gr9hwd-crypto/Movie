{"version":3,"file":"AuthSuccess-mQuzAmuj.js","sources":["../../src/components/AuthSuccess.vue"],"sourcesContent":["<template>\r\n  <div class=\"auth-success-container\">\r\n    <div v-if=\"loading\" class=\"loading-message\">\r\n      <p>Происходит авторизация...</p>\r\n      <div class=\"spinner\"></div>\r\n    </div>\r\n    <div v-if=\"moveHistory\" class=\"loading-message2\">\r\n      <p>Переносим историю...</p>\r\n      <div class=\"spinner\"></div>\r\n    </div>\r\n    <div v-if=\"error\" class=\"error-message\">\r\n      <p>Ошибка авторизации: {{ error }}</p>\r\n      <router-link to=\"/login\" class=\"retry-button\">Попробовать снова</router-link>\r\n    </div>\r\n    <div v-if=\"success\" class=\"success-message\">\r\n      <p>Авторизация прошла успешно!</p>\r\n      <router-link to=\"/\" class=\"home-button\">На главную</router-link>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { useRouter } from 'vue-router'\r\nimport { useAuthStore } from '@/store/auth'\r\nimport { useMainStore } from '@/store/main'\r\nimport { ref, onMounted } from 'vue'\r\nimport { getMyLists, addToList, getUser } from '@/api/user'\r\nimport { USER_LIST_TYPES_ENUM } from '@/constants'\r\nexport default {\r\n  name: 'AuthSuccess',\r\n  setup() {\r\n    const router = useRouter()\r\n    const authStore = useAuthStore()\r\n    const mainStore = useMainStore()\r\n    const loading = ref(true)\r\n    const moveHistory = ref(false)\r\n    const success = ref(false)\r\n    const error = ref(null)\r\n    const base = ref(import.meta.env.VITE_BASE_URL || '/')\r\n\r\n    const processAuth = async () => {\r\n      try {\r\n        const urlParams = new URLSearchParams(window.location.search)\r\n        const token = urlParams.get('token')\r\n\r\n        if (!token) {\r\n          throw new Error('Токен авторизации не найден')\r\n        }\r\n        authStore.setToken(token)\r\n\r\n        window.history.replaceState({}, document.title, `${base.value}auth-success`)\r\n\r\n        let user = await getUser()\r\n        authStore.setUser(user)\r\n        let response = await getMyLists(USER_LIST_TYPES_ENUM.HISTORY)\r\n        console.log(`response.length: ${response.length}`)\r\n        if (response.length !== 0) {\r\n          loading.value = false\r\n\r\n          success.value = true\r\n          setTimeout(async () => {\r\n            await router.push({ path: '/' })\r\n            router.go(0)\r\n          }, 2000)\r\n          return\r\n        }\r\n        loading.value = false\r\n        moveHistory.value = true\r\n        try {\r\n          for (const title of [...mainStore.history].reverse()) {\r\n            await addToList(title.kp_id, USER_LIST_TYPES_ENUM.HISTORY)\r\n          }\r\n        } catch (err) {\r\n          console.error('Auth error:', err)\r\n          error.value = 'Произошла ошибка при переноси истории, попробуйте позднее...'\r\n          moveHistory.value = false\r\n        }\r\n        moveHistory.value = false\r\n        success.value = true\r\n        setTimeout(async () => {\r\n          await router.push({ path: '/' })\r\n          router.go(0)\r\n        }, 2000)\r\n        console.log(response)\r\n      } catch (err) {\r\n        console.error('Auth error:', err)\r\n        error.value = err.message\r\n        loading.value = false\r\n      }\r\n    }\r\n\r\n    onMounted(() => {\r\n      processAuth()\r\n    })\r\n\r\n    return {\r\n      loading,\r\n      success,\r\n      moveHistory,\r\n      error\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.auth-success-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  height: 100vh;\r\n  text-align: center;\r\n  padding: 20px;\r\n}\r\n\r\n.loading-message,\r\n.loading-message2,\r\n.success-message,\r\n.error-message {\r\n  max-width: 400px;\r\n  padding: 20px;\r\n  border-radius: 8px;\r\n}\r\n\r\n.loading-message {\r\n  background-color: #1d1d1d;\r\n}\r\n\r\n.success-message {\r\n  background-color: #1d1d1d;\r\n  color: white;\r\n}\r\n\r\n.error-message {\r\n  background-color: #1d1d1d;\r\n  color: white;\r\n}\r\n\r\n.spinner {\r\n  border: 4px solid rgba(0, 0, 0, 0.1);\r\n  border-radius: 50%;\r\n  border-top: 4px solid #4caf50;\r\n  width: 30px;\r\n  height: 30px;\r\n  animation: spin 1s linear infinite;\r\n  margin: 20px auto;\r\n}\r\n\r\n@keyframes spin {\r\n  0% {\r\n    transform: rotate(0deg);\r\n  }\r\n  100% {\r\n    transform: rotate(360deg);\r\n  }\r\n}\r\n\r\n.retry-button,\r\n.home-button {\r\n  display: inline-block;\r\n  margin-top: 15px;\r\n  padding: 8px 16px;\r\n  background-color: #4caf50;\r\n  color: white;\r\n  text-decoration: none;\r\n  border-radius: 4px;\r\n  transition: background-color 0.3s;\r\n}\r\n\r\n.retry-button:hover,\r\n.home-button:hover {\r\n  background-color: #242424;\r\n}\r\n</style>\r\n"],"names":["_sfc_main","router","useRouter","authStore","useAuthStore","mainStore","useMainStore","loading","ref","moveHistory","success","error","base","processAuth","token","user","getUser","response","getMyLists","USER_LIST_TYPES_ENUM","title","addToList","err","onMounted","_hoisted_1","_openBlock","_createElementBlock","$setup","_hoisted_2","_cache","_createElementVNode","_createCommentVNode","_hoisted_3","_hoisted_4","_toDisplayString","_createVNode","_component_router_link","_withCtx","_createTextVNode","_hoisted_5"],"mappings":"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"}