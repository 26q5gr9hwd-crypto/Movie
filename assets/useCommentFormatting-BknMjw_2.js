import{ay as v}from"./index-R-36ZGTH.js";const H=t=>{if(!t)return"";const e=t.substring(0,4),m=t.substring(4,6),d=t.substring(6,8),s=t.substring(9,11),n=t.substring(11,13),o=t.substring(13,15);return new Date(Date.UTC(parseInt(e),parseInt(m)-1,parseInt(d),parseInt(s),parseInt(n),parseInt(o))).toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone})},A=t=>{if(!t)return"";const e=t.substring(0,4),m=t.substring(4,6),d=t.substring(6,8),s=t.substring(9,11),n=t.substring(11,13),o=t.substring(13,15),p=new Date(Date.UTC(parseInt(e),parseInt(m)-1,parseInt(d),parseInt(s),parseInt(n),parseInt(o))),c=Math.floor((new Date-p)/1e3);if(c<60)return"только что";const i=Math.floor(c/60);if(i<60)return"".concat(i," ").concat(R(i)," назад");const a=Math.floor(i/60);if(a<24)return"".concat(a," ").concat(V(a)," назад");const f=Math.floor(a/24);if(f<7)return"".concat(f," ").concat(y(f)," назад");const l=Math.floor(f/7);if(l<4)return"".concat(l," ").concat(L(l)," назад");const r=Math.floor(f/30);if(r<12)return"".concat(r," ").concat(w(r)," назад");const g=Math.floor(f/365);return"".concat(g," ").concat(S(g)," назад")},R=t=>t%10===1&&t%100!==11?"минуту":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"минуты":"минут",V=t=>t%10===1&&t%100!==11?"час":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"часа":"часов",y=t=>t%10===1&&t%100!==11?"день":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"дня":"дней",L=t=>t%10===1&&t%100!==11?"неделю":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"недели":"недель",w=t=>t%10===1&&t%100!==11?"месяц":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"месяца":"месяцев",S=t=>t%10===1&&t%100!==11?"год":[2,3,4].includes(t%10)&&![12,13,14].includes(t%100)?"года":"лет";function z(t,e=!1){const m=[],d=t.replace(/\[[^\]]*\d+[^\]]*\]/g,""),s=/(\d{1,2}:)?\d{1,2}:\d{2}|\d{1,2}:\d{2}/g,n=[...d.matchAll(s)];if(n.length>0){let o=0;for(;o<n.length;){const p=n[o][0];let u=null;d.slice(n[o].index+p.length).match(/^[\s,\-–—]+/)&&n[o+1]?(u=n[o+1][0],o+=2):o+=1;const i=l=>{if(!l)return null;const r=l.split(":").map(Number);return r.length===3?r[0]*3600+r[1]*60+r[2]:r.length===2?r[0]*60+r[1]:r.length===1?r[0]:null},a=i(p),f=i(u);if(a!==null&&f!==null){const l=e?a:Math.max(0,a-1),r=e?f:f+1;m.push([l,r])}else if(a!==null){const l=e?a:Math.max(0,a-1),r=a+5;m.push([l,r])}}}return m}function F(t){const e=Math.floor(t/3600),m=Math.floor(t%3600/60),d=Math.floor(t%60);return"".concat(e.toString().padStart(2,"0"),":").concat(m.toString().padStart(2,"0"),":").concat(d.toString().padStart(2,"0"))}function O(){const t=s=>{try{const n=new URL(s);return n.hostname==="cdn.7tv.app"&&n.protocol==="https:"||n.pathname.includes("/api/7tv")&&n.protocol==="https:"?"".concat(v()).concat(n.pathname).concat(n.search).concat(n.hash):(console.warn("URL изображения отклонен:",{url:s,hostname:n.hostname,protocol:n.protocol,reason:n.hostname!=="cdn.7tv.app"?"неразрешенный домен":"неразрешенный протокол"}),!1)}catch(n){return console.warn("Недопустимый URL изображения:",s,"Ошибка:",n.message),!1}},e=s=>{const n=document.createElement("div");return n.textContent=s,n.innerHTML},m=s=>{if(!s)return"";let n=s;return n=n.replace(/\[spoiler\]\s*\[\/spoiler\]/g,""),n=n.replace(/\[img\]\s*\[\/img\]/g,""),n=n.replace(/\[link=[^\]]+\]\s*\[\/link\]/g,""),n=n.replace(new RegExp("\\[spoiler\\](.*?)\\[\\/spoiler\\]","gs"),(o,p,u,c)=>{const i=p.trim();if(!i)return"";const l=i.split(/(\[img\].*?\[\/img\]|\[link=.*?\[\/link\])/).filter(Boolean).map(T=>T.startsWith("[img]")?T.replace(/\[img\](.*?)\[\/img\]/g,(D,I)=>{const U=I.trim(),h=t(U);if(h&&h!==!1){const $=e(h);return'<span class="spoiler-hidden-content"><img src="'.concat($,'" alt="7TV emote" class="inline-emoji" loading="lazy" /></span>')}return"[недопустимое изображение: ".concat(e(U),"]")}):T.startsWith("[link=")?T.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(D,I,U)=>{const h=I.trim(),$=U.trim();if(!$)return"";if(/^https?:\/\//.test(h)&&$){const x=e(h),W=e($);return'<a href="'.concat(x,'" target="_blank" rel="noopener noreferrer" class="comment-link">').concat(W,"</a>")}return e($||h)}):e(T)).join(""),r=u>0?c[u-1]:" ",g=u+o.length<c.length?c[u+o.length]:" ",M=r&&r!==" "&&r!=="\n"&&r!=="	",b=g&&g!==" "&&g!=="\n"&&g!=="	",k=M?" ":"",C=b?" ":"";return"".concat(k,'<span class="spoiler-text" onclick="this.classList.toggle(\'revealed\')" title="Нажмите, чтобы показать спойлер">').concat(l,"</span>").concat(C)}),n=n.replace(/\[img\](.*?)\[\/img\]/g,(o,p)=>{const u=p.trim(),c=t(u);if(c&&c!==!1){const i=e(c);return'<img src="'.concat(i,'" alt="7TV emote" class="inline-emoji" loading="lazy" />')}return"[недопустимое изображение: ".concat(e(u),"]")}),n=n.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(o,p,u)=>{const c=p.trim(),i=u.trim();if(!i)return"";if(/^https?:\/\//.test(c)&&i){const f=e(c),l=e(i);return'<a href="'.concat(f,'" target="_blank" rel="noopener noreferrer" class="comment-link">').concat(l,"</a>")}return e(i||c)}),n};return{formatContent:m,formatContentWithTruncation:s=>s?m(s):"",isValidImageUrl:t,escapeHtml:e}}export{A as a,H as b,F as f,z as p,O as u};
