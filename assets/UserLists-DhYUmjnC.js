import{_ as x,r as u,U as l,q as I,N as O,u as V,x as P,o as j,b as h,e as i,f as M,k as N,g as w,O as R,P as G,t as E,A as c,n as D,E as z,aE as H,K,G as C,aF as W,B as Y,d as p,m as Z,M as J,Z as Q}from"./index-Bpsq9sUo.js";import{M as X}from"./MovieList-6WX90t0D.js";import{N as ee}from"./ToastMessage-CA6P4YJ5.js";import{B as se}from"./BaseModal-DyESYTaB.js";import"./SpinnerLoading-C3rrmisV.js";const ae={class:"wrapper"},te={class:"user-lists-page",tabindex:"0"},le={class:"controls"},oe={class:"filter-card type-card"},ie={class:"button-group type-buttons"},re=["disabled","onClick"],ne={key:0,class:"counter"},ue=["disabled"],ce=["disabled"],ve={key:0,class:"empty-state"},de={__name:"UserLists",setup(pe){const r=u([]),n=u(!0),a=u(l.FAVORITE),v=u(""),m=u(null),d=I(),y=O(),g=Y(),f=u(y.params.user_id),b=u(!1),k=u({}),S=V(),_=u(null),F=async()=>{var s;try{const e=window.location.origin+window.location.pathname.split("/lists")[0]+"/lists",o=f.value||((s=d.user)==null?void 0:s.id),t=y.query.type||a.value,T=o?"".concat(e,"/").concat(o,"?type=").concat(t):"".concat(e,"?type=").concat(t);await navigator.clipboard.writeText(T),_.value.showNotification("Скопировано")}catch(e){console.error("Ошибка копирования:",e)}},$=[{label:"Избранное",value:l.FAVORITE},{label:"Смотрю",value:l.WATCHING},{label:"Позже",value:l.LATER},{label:"Просмотрено",value:l.COMPLETED},{label:"Брошено",value:l.ABANDONED},{label:"Оценено",value:l.RATED}],A=async()=>{var s;try{const e=f.value||((s=d.user)==null?void 0:s.id);e&&(k.value=await W(e))}catch(e){console.error("Error fetching counters:",e)}},L=async()=>{n.value=!0,v.value="",m.value=null;try{f.value?r.value=await H(a.value,f.value):r.value=await K(a.value),await A()}catch(s){const{message:e,code:o}=C(s);v.value=e,m.value=o,r.value=[]}finally{n.value=!1}},B=s=>{a.value=s,g.push({query:{...y.query,type:s}})},U=async()=>{if(n.value=!0,d.token)try{await J(a.value),r.value=[],_.value.showNotification("Список очищен"),await A()}catch(s){const{message:e,code:o}=C(s);v.value=e,m.value=o,console.error("Ошибка при очистке списка:",s),o===401&&(d.logout(),await g.push("/login"),g.go(0))}n.value=!1,b.value=!1},q=async s=>{if(d.token)try{await Q(s,a.value),r.value=r.value.filter(e=>e.kp_id!==s),_.value.showNotification("Фильм удален из списка"),await A()}catch(e){const{message:o,code:t}=C(e);v.value=o,m.value=t,console.error("Ошибка при удалении фильма:",e),t===401&&(d.logout(),await g.push("/login"),g.go(0))}};return P(()=>y.query.type,s=>{s&&Object.values(l).includes(s)&&(a.value=s,L())}),j(()=>{const s=y.query.type;s&&Object.values(l).includes(s)&&(a.value=s),L()}),(s,e)=>{var o;return p(),h(R,null,[i("div",ae,[i("div",te,[i("div",le,[i("div",oe,[i("div",ie,[e[5]||(e[5]=i("i",{class:"material-icons card-icon"},"movie",-1)),(p(),h(R,null,G($,(t,T)=>i("button",{key:T,class:D(["filter-btn type-btn",{active:a.value===t.value,disabled:n.value}]),disabled:n.value,onClick:fe=>B(t.value)},[Z(E(t.label)+" ",1),k.value[t.value]?(p(),h("span",ne,E(k.value[t.value]),1)):w("",!0)],10,re)),64)),i("button",{class:"share-btn",onClick:e[0]||(e[0]=t=>F()),disabled:n.value,title:"Поделиться списком"},e[3]||(e[3]=[i("span",{class:"material-icons"},E("share"),-1)]),8,ue),!f.value||String(f.value)===String((o=c(d).user)==null?void 0:o.id)?(p(),h("button",{key:0,class:D(["clear-btn",{disabled:!r.value.length||a.value===c(l).RATED||n.value}]),disabled:!r.value.length||a.value===c(l).RATED||n.value,onClick:e[1]||(e[1]=t=>r.value.length&&a.value!==c(l).RATED&&(b.value=!0)),title:"Очистить список"},e[4]||(e[4]=[i("span",{class:"material-icons"},E("delete_sweep"),-1)]),10,ce)):w("",!0)])])]),r.value.length===0&&!n.value?(p(),h("div",ve,e[6]||(e[6]=[i("span",{class:"material-icons"},"movie",-1),i("p",null,"Нет фильмов для отображения",-1)]))):v.value?w("",!0):(p(),N(c(X),{key:1,"movies-list":r.value,"is-history":!1,"is-mobile":c(S).isMobile,"is-user-list":!0,"show-delete":a.value!==c(l).RATED,"show-star":a.value===c(l).RATED,loading:n.value,onItemDeleted:q},null,8,["movies-list","is-mobile","show-delete","show-star","loading"])),v.value?(p(),N(z,{key:2,message:v.value,code:m.value},null,8,["message","code"])):w("",!0)])]),M(ee,{ref_key:"notificationRef",ref:_},null,512),M(se,{"is-open":b.value,message:"Вы уверены, что хотите очистить список?",onConfirm:U,onClose:e[2]||(e[2]=t=>b.value=!1)},null,8,["is-open"])],64)}}},_e=x(de,[["__scopeId","data-v-20ff32b4"]]);export{_e as default};
