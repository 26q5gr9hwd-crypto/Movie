{"version":3,"file":"AuthSuccess-legacy-B6WnAKUG.js","sources":["../../src/components/AuthSuccess.vue"],"sourcesContent":["<template>\r\n  <div class=\"auth-success-container\">\r\n    <div v-if=\"loading\" class=\"loading-message\">\r\n      <p>Происходит авторизация...</p>\r\n      <div class=\"spinner\"></div>\r\n    </div>\r\n    <div v-if=\"moveHistory\" class=\"loading-message2\">\r\n      <p>Переносим историю...</p>\r\n      <div class=\"spinner\"></div>\r\n    </div>\r\n    <div v-if=\"error\" class=\"error-message\">\r\n      <p>Ошибка авторизации: {{ error }}</p>\r\n      <router-link to=\"/login\" class=\"retry-button\">Попробовать снова</router-link>\r\n    </div>\r\n    <div v-if=\"success\" class=\"success-message\">\r\n      <p>Авторизация прошла успешно!</p>\r\n      <router-link to=\"/\" class=\"home-button\">На главную</router-link>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { useRouter } from 'vue-router'\r\nimport { useAuthStore } from '@/store/auth'\r\nimport { useMainStore } from '@/store/main'\r\nimport { ref, onMounted } from 'vue'\r\nimport { getMyLists, addToList, getUser } from '@/api/user'\r\nimport { USER_LIST_TYPES_ENUM } from '@/constants'\r\nexport default {\r\n  name: 'AuthSuccess',\r\n  setup() {\r\n    const router = useRouter()\r\n    const authStore = useAuthStore()\r\n    const mainStore = useMainStore()\r\n    const loading = ref(true)\r\n    const moveHistory = ref(false)\r\n    const success = ref(false)\r\n    const error = ref(null)\r\n    const base = ref(import.meta.env.VITE_BASE_URL || '/')\r\n\r\n    const processAuth = async () => {\r\n      try {\r\n        const urlParams = new URLSearchParams(window.location.search)\r\n        const token = urlParams.get('token')\r\n\r\n        if (!token) {\r\n          throw new Error('Токен авторизации не найден')\r\n        }\r\n        authStore.setToken(token)\r\n\r\n        window.history.replaceState({}, document.title, `${base.value}auth-success`)\r\n\r\n        let user = await getUser()\r\n        authStore.setUser(user)\r\n        let response = await getMyLists(USER_LIST_TYPES_ENUM.HISTORY)\r\n        console.log(`response.length: ${response.length}`)\r\n        if (response.length !== 0) {\r\n          loading.value = false\r\n\r\n          success.value = true\r\n          setTimeout(async () => {\r\n            await router.push({ path: '/' })\r\n            router.go(0)\r\n          }, 2000)\r\n          return\r\n        }\r\n        loading.value = false\r\n        moveHistory.value = true\r\n        try {\r\n          for (const title of [...mainStore.history].reverse()) {\r\n            await addToList(title.kp_id, USER_LIST_TYPES_ENUM.HISTORY)\r\n          }\r\n        } catch (err) {\r\n          console.error('Auth error:', err)\r\n          error.value = 'Произошла ошибка при переноси истории, попробуйте позднее...'\r\n          moveHistory.value = false\r\n        }\r\n        moveHistory.value = false\r\n        success.value = true\r\n        setTimeout(async () => {\r\n          await router.push({ path: '/' })\r\n          router.go(0)\r\n        }, 2000)\r\n        console.log(response)\r\n      } catch (err) {\r\n        console.error('Auth error:', err)\r\n        error.value = err.message\r\n        loading.value = false\r\n      }\r\n    }\r\n\r\n    onMounted(() => {\r\n      processAuth()\r\n    })\r\n\r\n    return {\r\n      loading,\r\n      success,\r\n      moveHistory,\r\n      error\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.auth-success-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  height: 100vh;\r\n  text-align: center;\r\n  padding: 20px;\r\n}\r\n\r\n.loading-message,\r\n.loading-message2,\r\n.success-message,\r\n.error-message {\r\n  max-width: 400px;\r\n  padding: 20px;\r\n  border-radius: 8px;\r\n}\r\n\r\n.loading-message {\r\n  background-color: #1d1d1d;\r\n}\r\n\r\n.success-message {\r\n  background-color: #1d1d1d;\r\n  color: white;\r\n}\r\n\r\n.error-message {\r\n  background-color: #1d1d1d;\r\n  color: white;\r\n}\r\n\r\n.spinner {\r\n  border: 4px solid rgba(0, 0, 0, 0.1);\r\n  border-radius: 50%;\r\n  border-top: 4px solid #4caf50;\r\n  width: 30px;\r\n  height: 30px;\r\n  animation: spin 1s linear infinite;\r\n  margin: 20px auto;\r\n}\r\n\r\n@keyframes spin {\r\n  0% {\r\n    transform: rotate(0deg);\r\n  }\r\n  100% {\r\n    transform: rotate(360deg);\r\n  }\r\n}\r\n\r\n.retry-button,\r\n.home-button {\r\n  display: inline-block;\r\n  margin-top: 15px;\r\n  padding: 8px 16px;\r\n  background-color: #4caf50;\r\n  color: white;\r\n  text-decoration: none;\r\n  border-radius: 4px;\r\n  transition: background-color 0.3s;\r\n}\r\n\r\n.retry-button:hover,\r\n.home-button:hover {\r\n  background-color: #242424;\r\n}\r\n</style>\r\n"],"names":["_sfc_main","name","setup","router","useRouter","authStore","useAuthStore","mainStore","useMainStore","loading","ref","moveHistory","success","error","base","processAuth","_callee3","urlParams","token","user","response","_iterator","_step","title","_regeneratorRuntime","wrap","_context3","prev","next","URLSearchParams","window","location","search","get","Error","setToken","history","replaceState","document","value","getUser","sent","setUser","getMyLists","USER_LIST_TYPES_ENUM","HISTORY","console","log","length","setTimeout","_asyncToGenerator","mark","_callee","_context","push","path","go","stop","abrupt","_createForOfIteratorHelper","reverse","s","n","done","addToList","kp_id","t0","e","f","finish","t1","_callee2","_callee2$","_context2","t2","message","onMounted","_hoisted_1","class","key","_openBlock","_createElementBlock","$setup","_hoisted_2","_cache","_createElementVNode","_createCommentVNode","_hoisted_3","_hoisted_4","_toDisplayString","_createVNode","_component_router_link","to","default","_withCtx","_createTextVNode","_","_hoisted_5"],"mappings":"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"}