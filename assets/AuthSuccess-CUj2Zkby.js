import{_ as T,b as n,g as i,e as o,f as v,t as A,w as g,s as _,a7 as U,i as x,u as E,r as l,o as N,af as R,D as b,U as y,y as H,X as I,d as u}from"./index-BgBohOk2.js";const L={name:"AuthSuccess",setup(){const r=H(),e=x(),h=E(),s=l(!0),a=l(!1),c=l(!1),t=l(null),w=l("/reyohoho/"),S=async()=>{try{const p=new URLSearchParams(window.location.search).get("token");if(!p)throw new Error("Токен авторизации не найден");e.setToken(p),window.history.replaceState({},document.title,"".concat(w.value,"auth-success"));let k=await R();e.setUser(k);let m=await b(y.HISTORY);if(console.log("response.length: ".concat(m.length)),m.length!==0){s.value=!1,c.value=!0,setTimeout(async()=>{await r.push({path:"/"}),r.go(0)},2e3);return}s.value=!1,a.value=!0;try{for(const f of[...h.history].reverse())await I(f.kp_id,y.HISTORY)}catch(f){console.error("Auth error:",f),t.value="Произошла ошибка при переноси истории, попробуйте позднее...",a.value=!1}a.value=!1,c.value=!0,setTimeout(async()=>{await r.push({path:"/"}),r.go(0)},2e3),console.log(m)}catch(d){console.error("Auth error:",d),t.value=d.message,s.value=!1}};return N(()=>{S()}),{loading:s,success:c,moveHistory:a,error:t}}},M={class:"auth-success-container"},P={key:0,class:"loading-message"},V={key:1,class:"loading-message2"},B={key:2,class:"error-message"},C={key:3,class:"success-message"};function Y(r,e,h,s,a,c){const t=U("router-link");return u(),n("div",M,[s.loading?(u(),n("div",P,e[0]||(e[0]=[o("p",null,"Происходит авторизация...",-1),o("div",{class:"spinner"},null,-1)]))):i("",!0),s.moveHistory?(u(),n("div",V,e[1]||(e[1]=[o("p",null,"Переносим историю...",-1),o("div",{class:"spinner"},null,-1)]))):i("",!0),s.error?(u(),n("div",B,[o("p",null,"Ошибка авторизации: "+A(s.error),1),v(t,{to:"/login",class:"retry-button"},{default:g(()=>e[2]||(e[2]=[_("Попробовать снова")])),_:1})])):i("",!0),s.success?(u(),n("div",C,[e[4]||(e[4]=o("p",null,"Авторизация прошла успешно!",-1)),v(t,{to:"/",class:"home-button"},{default:g(()=>e[3]||(e[3]=[_("На главную")])),_:1})])):i("",!0)])}const O=T(L,[["render",Y],["__scopeId","data-v-561fe794"]]);export{O as default};
//# sourceMappingURL=AuthSuccess-CUj2Zkby.js.map
