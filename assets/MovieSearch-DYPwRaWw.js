import{_ as U,r as d,c as P,o as H,a as Y,b as k,d as f,e as l,f as w,w as W,g,t as z,T as J,h as j,u as q,i as Q,j as G,k as X,l as Z,n as S,m as ee,v as ae,p as te,q as $,s as se,x,E as B,y as le,z as oe,A as ne,B as re,C as D,D as ie,U as A,F as ue}from"./index-MTv4JcVH.js";import{B as ce}from"./BaseModal-m5Od9caY.js";import{D as ve,M as N}from"./MovieList-B_6b_4aN.js";const de={class:"donaters-wrapper"},R="donatersCache",pe={__name:"FooterDonaters",setup(K){const i=d([]),m=d(-1);let u=null;const n=P(()=>m.value===-1||!i.value.length?"":i.value[m.value]),a=async()=>{const c=new Date().toISOString().split("T")[0],p=localStorage.getItem(R);if(p)try{const{date:o,data:v}=JSON.parse(p);if(o===c){i.value=v;return}}catch(o){console.error("Ошибка кэша донатеров:",o)}try{const o=await j();i.value=o.split("\n").map(v=>v.trim()).filter(v=>v),localStorage.setItem(R,JSON.stringify({date:c,data:i.value}))}catch(o){console.error("Ошибка загрузки донатеров:",o)}};function h(){if(!i.value.length)return;const c=Math.floor(Math.random()*i.value.length);m.value=c}function r(){i.value.length!==0&&(h(),u=setInterval(h,4e3))}return H(async()=>{await a(),r()}),Y(()=>{u&&clearInterval(u)}),(c,p)=>(f(),k("footer",null,[l("div",de,[w(J,{name:"fade",mode:"out-in"},{default:W(()=>[n.value?(f(),k("span",{key:m.value,class:"donater"},z(n.value),1)):g("",!0)]),_:1})])]))}},fe=U(pe,[["__scopeId","data-v-5dec4e96"]]),me={class:"wrapper"},he={class:"mainpage"},ge={class:"search-type-buttons"},ke={class:"search-container"},_e={class:"input-wrapper"},ye=["placeholder","inputmode"],we={class:"icons"},Ie={class:"content-container"},Se={key:0},De={key:2},Ce={key:0,class:"no-results"},be={key:3,class:"search-prompt"},Me={__name:"MovieSearch",setup(K){const i=q(),m=Q(),u=le(),n=d("title"),a=d(""),h=d([]),r=d(!1),c=d(!1),p=d(!1),o=d(""),v=d(null),_=d([]);G(async()=>{if(r.value=!0,m.token)try{_.value=await ie(A.HISTORY),r.value=!1}catch(t){const{message:e,code:s}=D(t);o.value=e,v.value=s,console.error("Ошибка загрузки истории:",t),s===401&&(m.logout(),await u.push("/login"),u.go(0)),r.value=!1}else _.value=i.history,r.value=!1});function O(t){_.value=_.value.filter(e=>e.kp_id!==t)}const y=t=>{n.value=t,C()},V=t=>{n.value==="title"?a.value=t.target.value:a.value=t.target.value.replace(/\D+/g,"")},F=()=>({title:"Введите название фильма",kinopoisk:"Пример: 301 (Матрица)",shikimori:"Пример: 28171 (Повар-боец Сома)",imdb:"Пример: 0198781 (Корпорация монстров)"})[n.value]||"Введите название фильма",C=()=>{a.value="",h.value=[],c.value=!1},b=()=>{M.cancel(),a.value?I():alert("Введите запрос для поиска")},I=async()=>{r.value=!0,c.value=!0,h.value=[];try{if(n.value==="kinopoisk"){/^\d+$/.test(a.value)||(a.value=a.value.replace(/\D/g,"")),u.push({name:"movie-info",params:{kp_id:a.value}});return}if(n.value==="imdb"){/^\d+$/.test(a.value)||(a.value=a.value.replace(/\D/g,""));const t=await oe(a.value);if(t.id_kp)u.push({name:"movie-info",params:{kp_id:"".concat(t.id_kp)}});else throw new Error("Не найдено");return}if(n.value==="shikimori"){/^\d+$/.test(a.value)||(a.value=a.value.replace(/\D/g,""));const t=await ne(a.value);if(t.id_kp)u.push({name:"movie-info",params:{kp_id:"".concat(t.id_kp)}});else throw new Error("Не найдено");return}if(n.value==="title"){const t=await re(a.value);h.value=t.map(e=>{var s,E,T;return{...e,kp_id:e.id.toString(),rating_kp:((s=e.raw_data)==null?void 0:s.rating)!=="null"?(E=e.raw_data)==null?void 0:E.rating:null,type:(T=e.raw_data)==null?void 0:T.type}})}}catch(t){const{message:e,code:s}=D(t);o.value=e,v.value=s,console.error("Ошибка при поиске:",t)}finally{r.value=!1}},L=async()=>{if(r.value=!0,m.token)try{await ue(A.HISTORY),_.value=[],r.value=!1,p.value=!1}catch(t){const{message:e,code:s}=D(t);o.value=e,v.value=s,console.error("Ошибка загрузки истории:",t),s===401&&(m.logout(),await u.push("/login"),u.go(0)),r.value=!1,p.value=!1}else i.clearAllHistory(),r.value=!1,p.value=!1},M=X(()=>{a.value.length>=2?I():a.value.length<2&&(h.value=[],c.value=!1)},700);return H(()=>{const t=window.location.hash;if(t.startsWith("#search=")){const e=decodeURIComponent(t.replace("#search=",""));a.value=e,I()}else if(t.startsWith("#imdb=")){const e=decodeURIComponent(t.replace("#imdb=",""));y("imdb"),a.value=e,I()}else if(t.startsWith("#shiki")){const e=decodeURIComponent(t.replace("#shiki",""));y("shikimori"),a.value=e,I()}}),Z(a,()=>{n.value==="title"&&M()}),(t,e)=>(f(),k("div",me,[l("div",he,[l("div",ge,[l("button",{class:S({active:n.value==="title"}),onClick:e[0]||(e[0]=s=>y("title"))}," Название ",2),l("button",{class:S({active:n.value==="kinopoisk"}),onClick:e[1]||(e[1]=s=>y("kinopoisk"))}," ID Кинопоиск ",2),l("button",{class:S({active:n.value==="shikimori"}),onClick:e[2]||(e[2]=s=>y("shikimori"))}," ID Shikimori ",2),l("button",{class:S({active:n.value==="imdb"}),onClick:e[3]||(e[3]=s=>y("imdb"))}," ID IMDB ",2)]),l("div",ke,[l("div",_e,[ee(l("input",{ref:"searchInput","onUpdate:modelValue":e[4]||(e[4]=s=>a.value=s),placeholder:F(),class:"search-input",inputmode:n.value==="title"?"text":"numeric",onKeydown:te(b,["enter"]),onInput:V},null,40,ye),[[ae,a.value]]),l("div",we,[a.value?(f(),k("button",{key:0,class:"reset-button",onClick:C},e[7]||(e[7]=[l("i",{class:"fas fa-times"},null,-1)]))):g("",!0),l("button",{class:"search-button",onClick:b},e[8]||(e[8]=[l("i",{class:"fas fa-search"},null,-1)]))])])]),l("div",Ie,[!a.value&&_.value.length>0?(f(),k("div",Se,[l("h2",null,[e[9]||(e[9]=se(" История просмотра ")),l("span",null,[w(ve,{onClick:e[5]||(e[5]=s=>p.value=!0)}),w(ce,{"is-open":p.value,message:"Вы уверены, что хотите очистить историю?",onConfirm:L,onClose:e[6]||(e[6]=s=>p.value=!1)},null,8,["is-open"])])]),w(x(N),{"movies-list":_.value,"is-history":!0,loading:r.value,onItemDeleted:O},null,8,["movies-list","loading"])])):g("",!0),!a.value&&o.value?(f(),$(B,{key:1,message:o.value,code:v.value},null,8,["message","code"])):g("",!0),c.value?(f(),k("div",De,[e[10]||(e[10]=l("h2",null,"Результаты поиска",-1)),w(x(N),{"movies-list":h.value,"is-history":!1,loading:r.value},null,8,["movies-list","loading"]),h.value.length===0&&!r.value&&!o.value?(f(),k("div",Ce," Ничего не найдено ")):g("",!0),o.value?(f(),$(B,{key:1,message:o.value,code:v.value},null,8,["message","code"])):g("",!0)])):g("",!0),a.value&&!c.value&&!r.value&&!o.value?(f(),k("div",be,' Нажмите кнопку "Поиск" или Enter для поиска ')):g("",!0)])]),w(fe)]))}},xe=U(Me,[["__scopeId","data-v-d478c53e"]]);export{xe as default};
//# sourceMappingURL=MovieSearch-DYPwRaWw.js.map
