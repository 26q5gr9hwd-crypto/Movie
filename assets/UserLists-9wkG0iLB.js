import{_ as $,r as n,U as o,i as I,N as O,u as z,o as H,b as g,e as s,f as A,x as C,g as _,K as N,L as P,t as b,y as v,n as M,E as G,as as J,H as K,D as T,at as W,z as Y,d,s as j,J as q,V as Q}from"./index-Bi7AMq12.js";import{M as X}from"./MovieList-CVZs7xzo.js";import{N as Z}from"./ToastMessage-BEzfBaNY.js";import{B as ee}from"./BaseModal-EYOh2ck4.js";import"./SpinnerLoading-DpAb9D90.js";const ae={class:"wrapper"},se={class:"user-lists-page",tabindex:"0"},te={class:"controls"},oe={class:"filter-card type-card"},le={class:"button-group type-buttons"},re=["onClick"],ie={key:0,class:"counter"},ne={key:0,class:"empty-state"},ue={__name:"UserLists",setup(ce){const l=n([]),f=n(!0),r=n(o.FAVORITE),u=n(""),p=n(null),c=I(),R=O(),y=Y(),m=n(R.params.user_id),w=n(!1),E=n({}),D=z(),h=n(null),S=async()=>{try{m.value?await navigator.clipboard.writeText("".concat(window.location.href)):await navigator.clipboard.writeText("".concat(window.location.href,"/").concat(c.user.id)),h.value.showNotification("Скопировано")}catch(a){console.error("Ошибка копирования:",a)}},x=[{label:"Избранное",value:o.FAVORITE},{label:"Смотрю",value:o.WATCHING},{label:"Позже",value:o.LATER},{label:"Просмотрено",value:o.COMPLETED},{label:"Брошено",value:o.ABANDONED},{label:"Оценено",value:o.RATED}],k=async()=>{var a;try{const e=m.value||((a=c.user)==null?void 0:a.id);e&&(E.value=await W(e))}catch(e){console.error("Error fetching counters:",e)}},L=async()=>{f.value=!0,u.value="",p.value=null;try{m.value?l.value=await J(r.value,m.value):l.value=await K(r.value),await k()}catch(a){const{message:e,code:i}=T(a);u.value=e,p.value=i,l.value=[]}finally{f.value=!1}},F=a=>{r.value=a,L()},B=async()=>{if(f.value=!0,c.token)try{await q(r.value),l.value=[],h.value.showNotification("Список очищен"),await k()}catch(a){const{message:e,code:i}=T(a);u.value=e,p.value=i,console.error("Ошибка при очистке списка:",a),i===401&&(c.logout(),await y.push("/login"),y.go(0))}f.value=!1,w.value=!1},U=async a=>{if(c.token)try{await Q(a,r.value),l.value=l.value.filter(e=>e.kp_id!==a),h.value.showNotification("Фильм удален из списка"),await k()}catch(e){const{message:i,code:t}=T(e);u.value=i,p.value=t,console.error("Ошибка при удалении фильма:",e),t===401&&(c.logout(),await y.push("/login"),y.go(0))}};return H(L),(a,e)=>{var i;return d(),g(N,null,[s("div",ae,[s("div",se,[s("div",te,[s("div",oe,[s("div",le,[e[5]||(e[5]=s("i",{class:"material-icons card-icon"},"movie",-1)),(d(),g(N,null,P(x,(t,V)=>s("button",{key:V,class:M(["filter-btn type-btn",{active:r.value===t.value}]),onClick:ve=>F(t.value)},[j(b(t.label)+" ",1),E.value[t.value]?(d(),g("span",ie,b(E.value[t.value]),1)):_("",!0)],10,re)),64)),s("button",{class:"share-btn",onClick:e[0]||(e[0]=t=>S()),title:"Поделиться списком"},e[3]||(e[3]=[s("span",{class:"material-icons"},b("share"),-1)])),!m.value||String(m.value)===String((i=v(c).user)==null?void 0:i.id)?(d(),g("button",{key:0,class:M(["clear-btn",{disabled:!l.value.length||r.value===v(o).RATED}]),onClick:e[1]||(e[1]=t=>l.value.length&&r.value!==v(o).RATED&&(w.value=!0)),title:"Очистить список"},e[4]||(e[4]=[s("span",{class:"material-icons"},b("delete_sweep"),-1)]),2)):_("",!0)])])]),l.value.length===0&&!f.value?(d(),g("div",ne,e[6]||(e[6]=[s("span",{class:"material-icons"},"movie",-1),s("p",null,"Нет фильмов для отображения",-1)]))):u.value?_("",!0):(d(),C(v(X),{key:1,"movies-list":l.value,"is-history":!1,"is-mobile":v(D).isMobile,"is-user-list":!0,"show-delete":r.value!==v(o).RATED,"show-star":r.value===v(o).RATED,loading:f.value,onItemDeleted:U},null,8,["movies-list","is-mobile","show-delete","show-star","loading"])),u.value?(d(),C(G,{key:2,message:u.value,code:p.value},null,8,["message","code"])):_("",!0)])]),A(Z,{ref_key:"notificationRef",ref:h},null,512),A(ee,{"is-open":w.value,message:"Вы уверены, что хотите очистить список?",onConfirm:B,onClose:e[2]||(e[2]=t=>w.value=!1)},null,8,["is-open"])],64)}}},ye=$(ue,[["__scopeId","data-v-8308c5cd"]]);export{ye as default};
