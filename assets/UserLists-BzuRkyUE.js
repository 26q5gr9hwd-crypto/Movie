import{_ as V,r,U as f,i as $,N as I,u as O,o as z,b as p,e as a,f as N,x as M,g as w,K as S,L as H,t as _,y as k,E as P,ag as G,H as J,D as L,ah as K,z as W,d as u,n as Y,s as j,J as q,V as Q}from"./index-BrRacj_z.js";import{M as X}from"./MovieList-BlVrXUgM.js";import{N as Z}from"./ToastMessage-DtKFNi8w.js";import{B as ee}from"./BaseModal-BZKGTkNJ.js";const se={class:"wrapper"},ae={class:"user-lists-page",tabindex:"0"},te={class:"controls"},oe={class:"filter-card type-card"},le={class:"button-group type-buttons"},re=["onClick"],ie={key:0,class:"counter"},ne={key:0,class:"empty-state"},ue={__name:"UserLists",setup(ce){const o=r([]),c=r(!0),v=r(f.FAVORITE),i=r(""),m=r(null),n=$(),T=I(),g=W(),d=r(T.params.user_id),y=r(!1),b=r({}),A=O(),h=r(null),x=async()=>{try{d.value?await navigator.clipboard.writeText("".concat(window.location.href)):await navigator.clipboard.writeText("".concat(window.location.href,"/").concat(n.user.id)),h.value.showNotification("Скопировано")}catch(s){console.error("Ошибка копирования:",s)}},F=[{label:"Избранное",value:f.FAVORITE},{label:"Смотрю",value:f.WATCHING},{label:"Позже",value:f.LATER},{label:"Просмотрено",value:f.COMPLETED},{label:"Брошено",value:f.ABANDONED}],C=async()=>{var s;try{const e=d.value||((s=n.user)==null?void 0:s.id);e&&(b.value=await K(e))}catch(e){console.error("Error fetching counters:",e)}},E=async()=>{c.value=!0,i.value="",m.value=null;try{d.value?o.value=await G(v.value,d.value):o.value=await J(v.value),await C()}catch(s){const{message:e,code:l}=L(s);i.value=e,m.value=l,o.value=[]}finally{c.value=!1}},R=s=>{v.value=s,E()},B=async()=>{if(c.value=!0,n.token)try{await q(v.value),o.value=[],h.value.showNotification("Список очищен")}catch(s){const{message:e,code:l}=L(s);i.value=e,m.value=l,console.error("Ошибка при очистке списка:",s),l===401&&(n.logout(),await g.push("/login"),g.go(0))}c.value=!1,y.value=!1},D=async s=>{if(n.token)try{await Q(s,v.value),o.value=o.value.filter(e=>e.kp_id!==s),h.value.showNotification("Фильм удален из списка"),await C()}catch(e){const{message:l,code:t}=L(e);i.value=l,m.value=t,console.error("Ошибка при удалении фильма:",e),t===401&&(n.logout(),await g.push("/login"),g.go(0))}};return z(E),(s,e)=>{var l;return u(),p(S,null,[a("div",se,[a("div",ae,[a("div",te,[a("div",oe,[a("div",le,[e[5]||(e[5]=a("i",{class:"material-icons card-icon"},"movie",-1)),(u(),p(S,null,H(F,(t,U)=>a("button",{key:U,class:Y(["filter-btn type-btn",{active:v.value===t.value}]),onClick:ve=>R(t.value)},[j(_(t.label)+" ",1),b.value[t.value]?(u(),p("span",ie,"("+_(b.value[t.value])+")",1)):w("",!0)],10,re)),64)),a("button",{class:"share-btn",onClick:e[0]||(e[0]=t=>x())},e[3]||(e[3]=[a("span",{class:"material-icons"},_("share"),-1)])),o.value.length>0&&(!d.value||String(d.value)===String((l=k(n).user)==null?void 0:l.id))?(u(),p("button",{key:0,class:"clear-btn",onClick:e[1]||(e[1]=t=>y.value=!0)},e[4]||(e[4]=[a("span",{class:"material-icons"},_("delete_sweep"),-1)]))):w("",!0)])])]),o.value.length===0&&!c.value?(u(),p("div",ne,e[6]||(e[6]=[a("span",{class:"material-icons"},"movie",-1),a("p",null,"Нет фильмов для отображения",-1)]))):i.value?w("",!0):(u(),M(k(X),{key:1,"movies-list":o.value,"is-history":!1,"is-mobile":k(A).isMobile,"is-user-list":!0,loading:c.value,onItemDeleted:D},null,8,["movies-list","is-mobile","loading"])),i.value?(u(),M(P,{key:2,message:i.value,code:m.value},null,8,["message","code"])):w("",!0)])]),N(Z,{ref_key:"notificationRef",ref:h},null,512),N(ee,{"is-open":y.value,message:"Вы уверены, что хотите очистить список?",onConfirm:B,onClose:e[2]||(e[2]=t=>y.value=!1)},null,8,["is-open"])],64)}}},ge=V(ue,[["__scopeId","data-v-26f49165"]]);export{ge as default};
//# sourceMappingURL=UserLists-BzuRkyUE.js.map
