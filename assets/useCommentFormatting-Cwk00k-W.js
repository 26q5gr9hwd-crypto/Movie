import{az as S}from"./index-377Ckn8Q.js";function B(){const u=r=>{try{const e=new URL(r);return e.hostname==="cdn.7tv.app"&&e.protocol==="https:"||e.pathname.includes("/api/7tv")&&e.protocol==="https:"?"".concat(S()).concat(e.pathname).concat(e.search).concat(e.hash):(console.warn("URL изображения отклонен:",{url:r,hostname:e.hostname,protocol:e.protocol,reason:e.hostname!=="cdn.7tv.app"?"неразрешенный домен":"неразрешенный протокол"}),!1)}catch(e){return console.warn("Недопустимый URL изображения:",r,"Ошибка:",e.message),!1}},t=r=>{const e=document.createElement("div");return e.textContent=r,e.innerHTML},U=r=>{if(!r)return"";let e=r;return e=e.replace(/\[spoiler\]\s*\[\/spoiler\]/g,""),e=e.replace(/\[img\]\s*\[\/img\]/g,""),e=e.replace(/\[link=[^\]]+\]\s*\[\/link\]/g,""),e=e.replace(new RegExp("\\[spoiler\\](.*?)\\[\\/spoiler\\]","gs"),(c,a,s,n)=>{const o=a.trim();if(!o)return"";const g=o.split(/(\[img\].*?\[\/img\]|\[link=.*?\[\/link\])/).filter(Boolean).map(m=>m.startsWith("[img]")?m.replace(/\[img\](.*?)\[\/img\]/g,(x,h)=>{const f=h.trim(),i=u(f);if(i&&i!==!1){const l=t(i);return'<span class="spoiler-hidden-content"><img src="'.concat(l,'" alt="7TV emote" class="inline-emoji" loading="lazy" /></span>')}return"[недопустимое изображение: ".concat(t(f),"]")}):m.startsWith("[link=")?m.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(x,h,f)=>{const i=h.trim(),l=f.trim();if(!l)return"";if(/^https?:\/\//.test(i)&&l){const L=t(i),R=t(l);return'<a href="'.concat(L,'" target="_blank" rel="noopener noreferrer" class="comment-link">').concat(R,"</a>")}return t(l||i)}):t(m)).join(""),p=s>0?n[s-1]:" ",d=s+c.length<n.length?n[s+c.length]:" ",C=p&&p!==" "&&p!=="\n"&&p!=="	",T=d&&d!==" "&&d!=="\n"&&d!=="	",V=C?" ":"",v=T?" ":"";return"".concat(V,'<span class="spoiler-text" onclick="this.classList.toggle(\'revealed\')" title="Нажмите, чтобы показать спойлер">').concat(g,"</span>").concat(v)}),e=e.replace(/\[img\](.*?)\[\/img\]/g,(c,a)=>{const s=a.trim(),n=u(s);if(n&&n!==!1){const o=t(n);return'<img src="'.concat(o,'" alt="7TV emote" class="inline-emoji" loading="lazy" />')}return"[недопустимое изображение: ".concat(t(s),"]")}),e=e.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(c,a,s)=>{const n=a.trim(),o=s.trim();if(!o)return"";if(/^https?:\/\//.test(n)&&o){const $=t(n),g=t(o);return'<a href="'.concat($,'" target="_blank" rel="noopener noreferrer" class="comment-link">').concat(g,"</a>")}return t(o||n)}),e};return{formatContent:U,formatContentWithTruncation:r=>r?U(r):"",isValidImageUrl:u,escapeHtml:t}}export{B as u};
