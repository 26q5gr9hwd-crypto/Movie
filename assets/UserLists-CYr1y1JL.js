import{_ as V,r,U as u,i as $,N as I,u as O,o as z,b as p,e as a,f as N,x as M,g as _,K as T,L as H,t as h,y as k,E as P,an as G,H as J,D as E,ao as K,z as W,d as c,n as Y,s as j,J as q,V as Q}from"./index-vOU0f-aR.js";import{M as X}from"./MovieList-DpXd3D_o.js";import{N as Z}from"./ToastMessage-Ce4o1tt1.js";import{B as ee}from"./BaseModal-DQVdLQpD.js";const se={class:"wrapper"},ae={class:"user-lists-page",tabindex:"0"},te={class:"controls"},oe={class:"filter-card type-card"},le={class:"button-group type-buttons"},re=["onClick"],ie={key:0,class:"counter"},ne={key:0,class:"empty-state"},ue={__name:"UserLists",setup(ce){const o=r([]),v=r(!0),d=r(u.FAVORITE),i=r(""),m=r(null),n=$(),S=I(),g=W(),f=r(S.params.user_id),y=r(!1),b=r({}),A=O(),w=r(null),R=async()=>{try{f.value?await navigator.clipboard.writeText("".concat(window.location.href)):await navigator.clipboard.writeText("".concat(window.location.href,"/").concat(n.user.id)),w.value.showNotification("Скопировано")}catch(s){console.error("Ошибка копирования:",s)}},x=[{label:"Избранное",value:u.FAVORITE},{label:"Смотрю",value:u.WATCHING},{label:"Позже",value:u.LATER},{label:"Просмотрено",value:u.COMPLETED},{label:"Брошено",value:u.ABANDONED},{label:"Оценено",value:u.RATED}],L=async()=>{var s;try{const e=f.value||((s=n.user)==null?void 0:s.id);e&&(b.value=await K(e))}catch(e){console.error("Error fetching counters:",e)}},C=async()=>{v.value=!0,i.value="",m.value=null;try{f.value?o.value=await G(d.value,f.value):o.value=await J(d.value),await L()}catch(s){const{message:e,code:l}=E(s);i.value=e,m.value=l,o.value=[]}finally{v.value=!1}},D=s=>{d.value=s,C()},F=async()=>{if(v.value=!0,n.token)try{await q(d.value),o.value=[],w.value.showNotification("Список очищен")}catch(s){const{message:e,code:l}=E(s);i.value=e,m.value=l,console.error("Ошибка при очистке списка:",s),l===401&&(n.logout(),await g.push("/login"),g.go(0))}v.value=!1,y.value=!1},B=async s=>{if(n.token)try{await Q(s,d.value),o.value=o.value.filter(e=>e.kp_id!==s),w.value.showNotification("Фильм удален из списка"),await L()}catch(e){const{message:l,code:t}=E(e);i.value=l,m.value=t,console.error("Ошибка при удалении фильма:",e),t===401&&(n.logout(),await g.push("/login"),g.go(0))}};return z(C),(s,e)=>{var l;return c(),p(T,null,[a("div",se,[a("div",ae,[a("div",te,[a("div",oe,[a("div",le,[e[5]||(e[5]=a("i",{class:"material-icons card-icon"},"movie",-1)),(c(),p(T,null,H(x,(t,U)=>a("button",{key:U,class:Y(["filter-btn type-btn",{active:d.value===t.value}]),onClick:ve=>D(t.value)},[j(h(t.label)+" ",1),b.value[t.value]?(c(),p("span",ie,"("+h(b.value[t.value])+")",1)):_("",!0)],10,re)),64)),a("button",{class:"share-btn",onClick:e[0]||(e[0]=t=>R()),title:"Поделиться списком"},e[3]||(e[3]=[a("span",{class:"material-icons"},h("share"),-1)])),o.value.length>0&&(!f.value||String(f.value)===String((l=k(n).user)==null?void 0:l.id))?(c(),p("button",{key:0,class:"clear-btn",onClick:e[1]||(e[1]=t=>y.value=!0),title:"Очистить список"},e[4]||(e[4]=[a("span",{class:"material-icons"},h("delete_sweep"),-1)]))):_("",!0)])])]),o.value.length===0&&!v.value?(c(),p("div",ne,e[6]||(e[6]=[a("span",{class:"material-icons"},"movie",-1),a("p",null,"Нет фильмов для отображения",-1)]))):i.value?_("",!0):(c(),M(k(X),{key:1,"movies-list":o.value,"is-history":!1,"is-mobile":k(A).isMobile,"is-user-list":!0,loading:v.value,onItemDeleted:B},null,8,["movies-list","is-mobile","loading"])),i.value?(c(),M(P,{key:2,message:i.value,code:m.value},null,8,["message","code"])):_("",!0)])]),N(Z,{ref_key:"notificationRef",ref:w},null,512),N(ee,{"is-open":y.value,message:"Вы уверены, что хотите очистить список?",onConfirm:F,onClose:e[2]||(e[2]=t=>y.value=!1)},null,8,["is-open"])],64)}}},ge=V(ue,[["__scopeId","data-v-b9df6b30"]]);export{ge as default};
